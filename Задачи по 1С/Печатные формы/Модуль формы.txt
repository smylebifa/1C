Функция СформироватьПечатнуюФормуУПД(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  ТабличныйДокумент.АвтоМасштаб = Истина;
  ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  ТабличныйДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_УПД_МОДИФИЦИРОВАННЫЙ";
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
    "ВЫБРАТЬ
    | ЗаказКлиента.Ссылка КАК Ссылка,
    | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
    | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
    | ЗаказКлиента.Номер КАК Номер,
    | ЗаказКлиента.Дата КАК Дата,
    | ЗаказКлиента.Представление КАК Представление,
    | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
    | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
    | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
    | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
    | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
    | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
    | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
    | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
    | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
    | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
    | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
    | ЗаказКлиента.Контрагент КАК Контрагент,
    | ЗаказКлиента.Организация КАК Организация,
    | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
    | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
    | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
    | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
    | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
    | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
    | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
    |ПОМЕСТИТЬ втЗаказКлиента
    |ИЗ
    | Документ.ЗаказКлиента КАК ЗаказКлиента
    |ГДЕ
    | ЗаказКлиента.Ссылка В(&МассивСсылок)
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
    | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
    | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
    | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
    | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
    | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
    | ЗаказКлиентаТовары.Цена КАК Цена,
    | ЗаказКлиентаТовары.Количество КАК Количество,
    | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
    | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
    | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
    | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
    | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
    | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
    | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
    | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
    | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
    | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
    |ПОМЕСТИТЬ втТовары
    |ИЗ
    | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
    |ГДЕ
    | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
    | втТовары.Ссылка КАК Ссылка
    |ПОМЕСТИТЬ КоличествоТоваров
    |ИЗ
    | втТовары КАК втТовары
    |
    |СГРУППИРОВАТЬ ПО
    | втТовары.Ссылка
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
    | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
    | втЗаказКлиента.Ссылка КАК Ссылка1
    |ПОМЕСТИТЬ втОрганизацияТелефон
    |ИЗ
    | втЗаказКлиента КАК втЗаказКлиента
    |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
    |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
    |ГДЕ
    | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
    | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
    | втЗаказКлиента.Ссылка КАК Ссылка1,
    | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
    |ПОМЕСТИТЬ втОрганизацияАдрес
    |ИЗ
    | втЗаказКлиента КАК втЗаказКлиента
    |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
    |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
    |ГДЕ
    | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
    | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
    | втЗаказКлиента.Ссылка КАК Ссылка1
    |ПОМЕСТИТЬ втКонтрагентТелефон
    |ИЗ
    | втЗаказКлиента КАК втЗаказКлиента
    |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
    |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
    |ГДЕ
    | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
    | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
    | втЗаказКлиента.Ссылка КАК Ссылка1
    |ПОМЕСТИТЬ втКонтрагентАдрес
    |ИЗ
    | втЗаказКлиента КАК втЗаказКлиента
    |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
    |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
    |ГДЕ
    | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
    | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
    |ПОМЕСТИТЬ втМаршрутныйЛист
    |ИЗ
    | втЗаказКлиента КАК втЗаказКлиента
    |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
    |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
    | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
    | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
    | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
    | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
    | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
    | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
    | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
    | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
    |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
    |ИЗ
    | втМаршрутныйЛист КАК втМаршрутныйЛист
    |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
    |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | РеализацияТоваровУслуг.Ссылка КАК Ссылка
    |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
    |ИЗ
    | втЗаказКлиента КАК втЗаказКлиента
    |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
    |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    | втЗаказКлиента.Ссылка КАК Ссылка,
    | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
    | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
    | втЗаказКлиента.Номер КАК Номер,
    | втЗаказКлиента.Дата КАК Дата,
    | втЗаказКлиента.Представление КАК Представление,
    | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
    | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
    | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
    | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
    | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
    | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
    | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
    | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
    | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
    | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
    | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
    | втТовары.НоменклатураКод КАК НоменклатураКод,
    | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
    | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
    | втТовары.СуммаСНДС КАК СуммаСНДС,
    | втТовары.СуммаНДС КАК СуммаНДС,
    | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
    | втТовары.Цена КАК Цена,
    | втТовары.Количество КАК Количество,
    | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
    | втТовары.НомерСтроки КАК НомерСтроки,
    | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
    | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
    | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
    | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
    | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
    | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
    | втОрганизацияАдрес.Представление КАК АдресОрганизации,
    | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
    | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
    | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
    | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
    | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
    | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
    | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
    | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
    | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
    | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
    | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
    | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
    | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
    | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
    | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
    | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
    | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
    | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
    | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
    | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
    | втОрганизацияАдрес.АдресЭП КАК АдресЭП
    |ИЗ
    | втЗаказКлиента КАК втЗаказКлиента
    |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
    |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
    |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
    |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
    |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
    |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
    |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
    |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
    |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
    |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
    |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
    |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
    | втТовары КАК втТовары
    |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
    |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда     
      Макет = ПолучитьМакет("ПФ_MXL_УниверсальныйПередаточныйДокумент534_ru");
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
      ОбластьЗаголовокТаблицы = Макет.ПолучитьОбласть("ЗаголовокТаблицы");
      ОбластьСтрокаКомплектующие = Макет.ПолучитьОбласть("СтрокаКомплектующие");
      ОбластьСтрокаНабор = Макет.ПолучитьОбласть("СтрокаНабор");
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьИтого = Макет.ПолучитьОбласть("Итого");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      ОбластьНумерацияЛистов = Макет.ПолучитьОбласть("НумерацияЛистов");
      
      ПервыйДокумент = Ложь;
      
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    
    // ОбластьШапки 
    ПараметрыШапки = Новый Структура;
    
    ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьШапка, Выборка.Ссылка);
    
    Дата = Формат(Выборка.Дата, "ДЛФ=ДД");
    
    НомерВВидеСтроки = Выборка.Номер;
    ДлинаНомера = СтрДлина(НомерВВидеСтроки);
    НачалоЧисловойЧасти = ДлинаНомера - 5;
    НомерВВидеЦифр = Сред(НомерВВидеСтроки, НачалоЧисловойЧасти, 6);
    
    Для Индекс = 0 По СтрДлина(НомерВВидеЦифр) Цикл
      Если Сред(НомерВВидеЦифр, Индекс, 1) <> "0" Тогда   
        Прервать;
      КонецЕсли;      
    КонецЦикла;
    
    Номер = Сред(НомерВВидеЦифр, Индекс, ДлинаНомера - Индекс);           
    
    ПараметрыШапки.Вставить("Номер", Номер);        
    ПараметрыШапки.Вставить("СтатусУПД", 1);    
    ПараметрыШапки.Вставить("Дата", Дата);    
    ПараметрыШапки.Вставить("НомерИсправления", "--");
    ПараметрыШапки.Вставить("ДатаИсправления", "--");
    ПараметрыШапки.Вставить("Валюта", НСтр("ru = 'Российский рубль, 643';
    |en = 'Russian ruble, 643'", Метаданные.Языки.Русский.КодЯзыка));   
    
    ПараметрыШапки.Вставить("ПредставлениеПоставщика", Выборка.ОрганизацияНаименованиеПолное);
    ПараметрыШапки.Вставить("АдресПоставщика", Выборка.АдресОрганизации);
    ПараметрыШапки.Вставить("ИННПоставщика", Выборка.ОрганизацияИНН + "/" + Выборка.ОрганизацияКПП);
    ПараметрыШапки.Вставить("ПредставлениеГрузоотправителя", "он же");
    
    ПараметрыШапки.Вставить("ПредставлениеПокупателя", Выборка.КонтрагентНаименованиеПолное);
    ПараметрыШапки.Вставить("АдресПокупателя", Выборка.АдресКонтрагента);
    ПараметрыШапки.Вставить("ИННПокупателя", Выборка.КонтрагентИНН + "/" + Выборка.КонтрагентКПП);
    ПараметрыШапки.Вставить("ПредставлениеГрузополучателя", Выборка.КонтрагентНаименованиеПолное + " ," + 
    Выборка.АдресКонтрагента);
    
    КоличествоСтрок = Выборка.КоличествоТоваров;    
    ПоДокументуОтгрузки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
    НСтр("ru = '№ п/п %1 № %2 от %3';
    |en = 'Item No. %1 No. %2 dated %3'"),
    ?(КоличествоСтрок = 1, "1" , "1-" + Формат(КоличествоСтрок, "ЧГ=0")), Номер, Дата);
    
    ПараметрыШапки.Вставить("ПоДокументуОтгрузки", ПоДокументуОтгрузки);
    ПараметрыШапки.Вставить("ПоДокументу", "-- от --");
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапки);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    
    // ОбластьСтрокаКомплектующие     
    ПараметрыСтрокаКомплектующие = Новый Структура;
    
    СуммаЦенаИтого = 0;
    СуммаСНДСИтого = 0;
    СуммаБезНДСИтого = 0;
    
    ПервыйТовар = Истина;
    НомерТовара = 1;
    
    ТабличныйДокумент.Вывести(ОбластьЗаголовокТаблицы);
    
    МассивВыводимыхОбластей = Новый Массив;
    НомерСтраницы = 1;
    
    Пока НомерТовара <= КоличествоСтрок Цикл 
      ПараметрыСтрокаКомплектующие.Вставить("НоменклатураКод", Выборка.НоменклатураКод);      
      ПараметрыСтрокаКомплектующие.Вставить("НомерСтроки", НомерТовара);
      ПараметрыСтрокаКомплектующие.Вставить("ПредставлениеНоменклатуры", Выборка.НоменклатураНаименование);     
      ПараметрыСтрокаКомплектующие.Вставить("КодТНВЭД", Выборка.НоменклатураКодТНВЭДКод);     
      ПараметрыСтрокаКомплектующие.Вставить("ЕдиницаИзмеренияКод", Выборка.НоменклатураЕдиницаИзмеренияКод);
      ПараметрыСтрокаКомплектующие.Вставить("ЕдиницаИзмеренияНаименование", Выборка.НоменклатураЕдиницаИзмеренияНаименование);      
      ПараметрыСтрокаКомплектующие.Вставить("Количество", Выборка.Количество);
      
      СуммаСНДС = Выборка.СуммаСНДС;
      СуммаБезНДС = Выборка.СуммаНДС;
      Цена = СуммаСНДС - СуммаБезНДС;
      
      СтавкаНДС = Строка(Выборка.СтавкаНДССтавка) + "%";
      
      ПараметрыСтрокаКомплектующие.Вставить("Цена", Цена); 
      ПараметрыСтрокаКомплектующие.Вставить("СуммаБезНДС", Цена);     
      ПараметрыСтрокаКомплектующие.Вставить("Акциз", "без акциза");
      ПараметрыСтрокаКомплектующие.Вставить("СтавкаНДС", СтавкаНДС);
      ПараметрыСтрокаКомплектующие.Вставить("СуммаНДС", СуммаБезНДС);
      ПараметрыСтрокаКомплектующие.Вставить("СуммаСНДС", СуммаСНДС);
      
      СуммаБезНДСИтого = СуммаБезНДСИтого + СуммаБезНДС;
      СуммаСНДСИтого = СуммаСНДСИтого + СуммаСНДС;
      СуммаЦенаИтого = СуммаЦенаИтого + Цена; 
        
      
      ОбластьСтрокаКомплектующие.Параметры.Заполнить(ПараметрыСтрокаКомплектующие); 
      
      МассивВыводимыхОбластей.Очистить();
      МассивВыводимыхОбластей.Добавить(ОбластьСтрокаКомплектующие);
      
      Если НомерТовара = КоличествоСтрок Тогда
        МассивВыводимыхОбластей.Добавить(ОбластьИтого);
        МассивВыводимыхОбластей.Добавить(ОбластьПодвал);
      КонецЕсли;

      
      Если НомерТовара <> 1 И НЕ ТабличныйДокумент.ПроверитьВывод(МассивВыводимыхОбластей) Тогда
        
        НомерСтраницы = НомерСтраницы + 1;
        ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();
        
        ОбластьНумерацияЛистов = Макет.ПолучитьОбласть("НумерацияЛистов");
        ОбластьНумерацияЛистов.Параметры.Номер = Номер;
        ОбластьНумерацияЛистов.Параметры.Дата = Формат(Выборка.Дата, "ДЛФ=ДД; ДП=--");
        ОбластьНумерацияЛистов.Параметры.НомерСтраницы = НомерСтраницы;
        
        ТабличныйДокумент.Вывести(ОбластьНумерацияЛистов);
        ТабличныйДокумент.Вывести(ОбластьЗаголовокТаблицы);
        
      КонецЕсли;
      
      ТабличныйДокумент.Вывести(ОбластьСтрокаКомплектующие);      
      
      НомерТовара = НомерТовара + 1;
      Выборка.Следующий();
      
    КонецЦикла;
    
    
    // Итоги
    ПараметрыИтого = Новый Структура;
    ПараметрыИтого.Вставить("ИтогоСуммаБезНДС", СуммаЦенаИтого);
    ПараметрыИтого.Вставить("ИтогоСуммаНДС", СуммаБезНДСИтого);
    ПараметрыИтого.Вставить("ИтогоСуммаСНДС", СуммаСНДСИтого);
    
    ОбластьИтого.Параметры.Заполнить(ПараметрыИтого); 
    ТабличныйДокумент.Вывести(ОбластьИтого);
    
    
    // Подвал
    ПараметрыПодвал = Новый Структура;
    ПараметрыПодвал.Вставить("КоличествоСтраниц", "Документ составлен на " + КоличествоСтрок + " листах");
    ПараметрыПодвал.Вставить("ФИОРуководителяОрганизации", Выборка.ОрганизацияИндивидуальныйПредпринимательФИО);
    ПараметрыПодвал.Вставить("ФИОПБОЮЛ", Выборка.ОрганизацияИндивидуальныйПредпринимательФИО);
    ПараметрыПодвал.Вставить("ПредставлениеКонтрагента", Выборка.КонтрагентНаименованиеПолное + 
    ", ИНН/КПП " + Выборка.КонтрагентИНН + "/" + Выборка.КонтрагентКПП);  
    
    ПараметрыПодвал.Вставить("Свидетельство", Выборка.ОрганизацияСвидетельствоСерияНомер);
    ПараметрыПодвал.Вставить("ФИОРуководителя", Выборка.РуководительФизическоеЛицоФИО);
    ПараметрыПодвал.Вставить("ПредставлениеОрганизации", Выборка.ОрганизацияНаименованиеПолное + 
    ", ИНН/КПП " + Выборка.ОрганизацияИНН + "/" + Выборка.ОрганизацияКПП);
    
    ПолнаяДатаДокумента = СтрЗаменить(Формат(Выборка.Дата, "ДЛФ=DD"),НСтр("ru = 'г.';
    |en = 'year'", Метаданные.Языки.Русский.КодЯзыка),"");
    ДлинаСтроки = СтрДлина(ПолнаяДатаДокумента);
    ПозицияРазделителя = СтрНайти(ПолнаяДатаДокумента, " ");
    ПредставлениеДаты = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
    НСтр("ru = '""%1"" %2года';
    |en = '""%1"" %2'", Метаданные.Языки.Русский.КодЯзыка),
    Лев(ПолнаяДатаДокумента, ПозицияРазделителя - 1),
    Прав(ПолнаяДатаДокумента, ДлинаСтроки - ПозицияРазделителя));
    
    ПараметрыПодвал.Вставить("ДатаДокумента", ПредставлениеДаты);
    
    ПараметрыПодвал.Вставить("Основание", "Заказ клиента № " + Номер + " от " + Дата);

    ОбластьПодвал.Параметры.Заполнить(ПараметрыПодвал); 
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуТранспортнаяНакладная(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  
  ТабличныйДокумент.АвтоМасштаб = Истина;
  ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
  
  //ТабличныйДокумент.ПолеСлева = 5;
  //ТабличныйДокумент.ПолеСправа = 5;
  //ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  //ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  //ТабличныйДокумент.АвтоМасштаб = Истина;
  //ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПФ_MXL_ТранспортнаяНакладная_2200";  
  
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  НомерСтраницы = 1;
  
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда     
      
      Макет = ПолучитьМакет("ПФ_MXL_ТранспортнаяНакладная_2200");
      
      
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      ОбластьЧасть1 = Макет.ПолучитьОбласть("Часть1");
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка");      
      
      ОбластьГоризонтальнаяОборотнаяСторона = Макет.ПолучитьОбласть("ГоризонтальнаяОборотнаяСторона");
      ОбластьЧасть2 = Макет.ПолучитьОбласть("Часть2");
      ПервыйДокумент = Ложь;
      
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    
    // ОбластьГоризонтальнаяЛицеваяСторона  
    ПараметрыГоризонтальнаяЛицеваяСторона = Новый Структура;
    
    ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьЧасть1, Выборка.Ссылка);
    
    
    Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(Выборка.Номер);
    ВыборкаДата = Формат (Выборка.Дата, "ДФ=dd.MM.yyyy");
    
    // Экземпляр №
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт0_1", "1");
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт0_4", ВыборкаДата);  
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт0_5", Номер);
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт0_2", ВыборкаДата);   
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт0_3",  Номер); 
    
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт1_1", ОрганизацияНаименованиеПолное);    
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт2_1", 21);
    
    НаименованиеПолноеОрганизации = Выборка.ОрганизацияНаименованиеПолное + ", ИНН " + Выборка.ОрганизацияИНН + ", " + Выборка.АдресОрганизации + ", "  + Выборка.ТелефонОрганизации;
    НаименованиеПолноеКонтрагент = Выборка.КонтрагентНаименованиеПолное + ", ИНН " + Выборка.КонтрагентИНН + ", " + Выборка.АдресКонтрагента + ", "  + Выборка.ТелефонКонтрагента;
    
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт1_2", НаименованиеПолноеОрганизации);   
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт2_2", НаименованиеПолноеКонтрагент); 
    
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт1а_1", 101);
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт2а_1", 201);
    
    ОбластьЧасть1.Параметры.Заполнить(ПараметрыГоризонтальнаяЛицеваяСторона);   
    ТабличныйДокумент.Вывести(ОбластьЧасть1);
    
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    Количество = Выборка.КоличествоТоваров;
    ПараметрыСтрока = Новый Структура;
    НомерТовара = 1;
    СтоимостьГруза = 0;
     
    
    Пока НомерТовара <= Количество Цикл 
      
      ПараметрыСтрока.Вставить("номер", НомерТовара); 
      ПараметрыСтрока.Вставить("кодТовара", Выборка.НоменклатураКодДляПоиска);   
      ПараметрыСтрока.Вставить("наименованиеТовара", Выборка.НоменклатураНаименование);   
      ПараметрыСтрока.Вставить("количество", Выборка.Количество);   
      
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);   
      ТабличныйДокумент.Вывести(ОбластьСтрока);
      
      НомерТовара = НомерТовара + 1;  
      Выборка.Следующий();
      СтоимостьГруза = СтоимостьГруза + Выборка.СуммаСНДС;
    КонецЦикла;
    
    ДокументыОснование = "Товарная накладная от " + ВыборкаДата + "№ " + Номер + ", счет-фактура от " 
    + ВыборкаДата + "№ " + Номер + "Продавец: " + Выборка.ОрганизацияПредставление + "Покупатель: " + Выборка.ГрузополучательПредставление;  
    
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт3_4", 3);  
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт3_5", 11);
    
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт4_1", "реестр сертификатов");
        
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт4_3", ДокументыОснование); 
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт5_1", 101);
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт5_2",201);
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт5_3",201);
    
    ТочнаяДата = Формат(Выборка.Дата, "ДЛФ=DT");
    
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("ОрганизацияНазваниеПолное", Выборка.ОрганизацияПредставление + ", " + Выборка.АдресОрганизации);  
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_1", Выборка.АдресОрганизации); 
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_2", ТочнаяДата);
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_3", ТочнаяДата);   
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_31", ТочнаяДата);  
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_4", "");
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_5", "");
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_51", "");   
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_6", Выборка.ГрузоотправительПредставление);  
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_7", Выборка.ОрганизацияПредставление1);
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт6_8", "");
    
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_1", Выборка.АдресКонтрагента); 
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_2", ТочнаяДата);
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_3", ТочнаяДата);   
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_31", ТочнаяДата);  
    
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_4", 11);
    
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_5", "Количество: тара: палеты");
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_51", 12);   
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_6", 22); 
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_7", Выборка.ОрганизацияПредставление1);
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт7_8",201);
    //
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт8_1", 4);  
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт8_2", 5);
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт8_3", 2);    
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт8_4", 11);
    //ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт8_5", 21);
    
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт9_1", ТочнаяДата); 
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("Пункт9_2", Выборка.ГрузоотправительПредставление);
    
    ПараметрыГоризонтальнаяЛицеваяСторона.Вставить("СтоимостьГруза", Формат(СтоимостьГруза, "ЧДЦ=2") + " р.");  
    
    ОбластьЧасть2.Параметры.Заполнить(ПараметрыГоризонтальнаяЛицеваяСторона);   
    
    ТабличныйДокумент.Вывести(ОбластьЧасть2);
    
    
    
    
    ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();
    
    // ОбластьГоризонтальнаяОборотнаяСторона  
    ПараметрыГоризонтальнаяОборотнаяСторона = Новый Структура;  
    
    
    
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт10_1",  Выборка.ОрганизацияПредставление1);  
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт10_2", 5);
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт10_3", 2);   
    //
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт11_1", Выборка.ОрганизацияПредставление1); 
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт11_2", Выборка.ОрганизацияПредставление1);
    //
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт12_1", 2);   
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт12_2", 3); 
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт12_3", 11);
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт12_4", 21);
    //
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт13_1", 12);   
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт13_2", 22);
    //
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт14_1", 2);   
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт14_2", 3); 
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт14_3", 11);
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт14_4", 21);
    //
    //ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт15_1", 4); 
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт15_2", Выборка.ГрузоотправительПредставление);
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт15_6", НаименованиеПолноеОрганизации); 
    
    НомерТелефона = Строка(Выборка.ТелефонОрганизации);
    ОргНаименование = Строка(Выборка.ОрганизацияНаименованиеПолное);
    
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт16_2", ОргНаименование + ", " + НомерТелефона);   
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт16_3",  Выборка.ГрузоотправительПредставление);  
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт16_6",  Выборка.ОрганизацияПредставление1);
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт16_11", ВыборкаДата);
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("Пункт16_21", ВыборкаДата);
    
    
    ПараметрыГоризонтальнаяОборотнаяСторона.Вставить("НомерСтраницы", "Номер страницы "  + НомерСтраницы);  
    
    
    ОбластьГоризонтальнаяОборотнаяСторона.Параметры.Заполнить(ПараметрыГоризонтальнаяОборотнаяСторона);   
    ТабличныйДокумент.Вывести(ОбластьГоризонтальнаяОборотнаяСторона);
    
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуТоварноТранспортнаяНакладная(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  
  ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  
  ТабличныйДокумент.АвтоМасштаб = Истина;
  ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПФ_MXL_ТТН"; 
  
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  НомерСтраницы = 1;
  
  Пока Выборка.Следующий() Цикл     
    
  Если ПервыйДокумент Тогда     
      Макет = ПолучитьМакет("ТоварноТранспортнаяНакладная");
      
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка"); 
      ОбластьЗаголовокТаблицы = Макет.ПолучитьОбласть("ЗаголовокТаблицы"); 
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьИтогоПоСтранице = Макет.ПолучитьОбласть("ИтогоПоСтранице");
      ОбластьВсего = Макет.ПолучитьОбласть("Всего");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      ОбластьТранспортныйРаздел = Макет.ПолучитьОбласть("ТранспортныйРаздел");
      ОбластьСведенияОГрузе = Макет.ПолучитьОбласть("СведенияОГрузе");
      ОбластьПодвалСведенийОГрузе = Макет.ПолучитьОбласть("ПодвалСведенийОГрузе");
      ОбластьПогрузочныеОперации = Макет.ПолучитьОбласть("ПогрузочныеОперации");
      ОбластьПрочиеСведения = Макет.ПолучитьОбласть("ПрочиеСведения");
      
      ПервыйДокумент = Ложь;
      
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    
    // ОбластьШапка 
    ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьШапка, Выборка.Ссылка);
    
    Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(Выборка.Номер);
    ВыборкаДата = Формат (Выборка.Дата, "ДФ=dd.MM.yyyy");
    
    ПараметрыШапка = Новый Структура;
    
    ТелефонКонтрагента = "";
    Если ЗначениеЗаполнено(Выборка.ТелефонКонтрагента) Тогда
      ТелефонКонтрагента = ", тел.: "  + Выборка.ТелефонКонтрагента;
    КонецЕсли;
    
    ТелефонОрганизации = "";
    Если ЗначениеЗаполнено(Выборка.ТелефонОрганизации) Тогда
      ТелефонОрганизации = ", тел.: "  + Выборка.ТелефонОрганизации;
    КонецЕсли;
    
    НаименованиеПолноеОрганизации = Выборка.ОрганизацияПредставление + ", " + Выборка.АдресОрганизации + ", ИНН/КПП " + Выборка.ОрганизацияИНН + "/" + Выборка.ОрганизацияКПП + ТелефонОрганизации;
    
    ДополнениеКНазванию = ", " + Выборка.АдресКонтрагента + ", ИНН/КПП " + Выборка.КонтрагентИНН + "/" + Выборка.КонтрагентКПП + ТелефонКонтрагента;
    
    НаименованиеРасширенноеКонтрагент = Выборка.КонтрагентНаименованиеПолное + ДополнениеКНазванию;
    НаименованиеПолноеКонтрагент = Выборка.КонтрагентПредставление + ", " + Выборка.АдресКонтрагента + ", ИНН/КПП " + Выборка.КонтрагентИНН + "/" + Выборка.КонтрагентКПП + ТелефонКонтрагента;
        
    ПараметрыШапка.Вставить("ПредставлениеОрганизации", НаименованиеПолноеОрганизации); 
    ПараметрыШапка.Вставить("ПредставлениеГрузополучателя", НаименованиеРасширенноеКонтрагент);
    ПараметрыШапка.Вставить("ПредставлениеПлательщика", НаименованиеПолноеКонтрагент);   
    ПараметрыШапка.Вставить("НомерДокумента", Номер);
    ПараметрыШапка.Вставить("ДатаДокумента", ВыборкаДата);  
    ПараметрыШапка.Вставить("ОрганизацияПоОКПО", Выборка.ОрганизацияКодПоОКПО);
    ПараметрыШапка.Вставить("ГрузополучательПоОКПО", Выборка.КонтрагентКодПоОКПО);   
    ПараметрыШапка.Вставить("ПлательщикПоОКПО", Выборка.КонтрагентКодПоОКПО); 
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    
    // ОбластьЗаголовокТаблицы  
    ПараметрыЗаголовокТаблицы = Новый Структура;  
    //ПараметрыЗаголовокТаблицы.Вставить("НомерСтраницы", "НомерСтраницы " + НомерСтраницы);
    
    НомерСтраницы = НомерСтраницы + 1;
    
    ОбластьЗаголовокТаблицы.Параметры.Заполнить(ПараметрыЗаголовокТаблицы);   
    ТабличныйДокумент.Вывести(ОбластьЗаголовокТаблицы);
    
    
    // ОбластьСтрока  
    ПараметрыСтрока = Новый Структура;  
    
        
    НомерТовара = 1;
    Товары = "";
    
    ВидУпаковки = "";
    
    ИтогоКоличество = 0;
    ИтогоСумма = 0;
    
    Количество = Выборка.КоличествоТоваров;

    Пока НомерТовара <= Количество Цикл 
      //Если НомерТовара > 1 Тогда
      //  Товары = Товары + Символы.ПС;     
      //КонецЕсли;        
      
      //Товары = Товары + " " + Выборка.НоменклатураНаименование + " " + Строка(Выборка.КоличествоТовара);      
      
      Если ЗначениеЗаполнено(Выборка.НоменклатураЕдиницаИзмеренияНаименование) Тогда
        ВидУпаковки = Выборка.НоменклатураЕдиницаИзмеренияНаименование;
      КонецЕсли;
      
      СуммаСНДС = Выборка.СуммаСНДС;
      СуммаНДС = Выборка.СуммаНДС;      
      Цена = СуммаСНДС - СуммаНДС;
      КоличествоТовара = Формат(Выборка.Количество, "ЧДЦ=0");
      
      //Вес = Формат(Выборка.НоменклатураЕдиницаИзмеренияВес, "ЧДЦ=3");
      МассаВТоннах = Выборка.НоменклатураВесЧислитель * 0.001 * 0.001;
      
      ПараметрыСтрока.Вставить("ТоварКод", "");       
      ПараметрыСтрока.Вставить("ТоварАртикул", "-");
      ПараметрыСтрока.Вставить("Количество", КоличествоТовара);
      ПараметрыСтрока.Вставить("Цена", Цена);
      ПараметрыСтрока.Вставить("ТоварНаименование", Выборка.НоменклатураНаименование);
      ПараметрыСтрока.Вставить("БазоваяЕдиницаНаименование", Выборка.НоменклатураЕдиницаИзмеренияНаименование); 
      //ПараметрыСтрока.Вставить("ВидУпаковки", Выборка.УпаковкаНаименование);
      ПараметрыСтрока.Вставить("МассаНетто", МассаВТоннах);
      ПараметрыСтрока.Вставить("Сумма", СуммаСНДС);
      //ПараметрыСтрока.Вставить("НомерЗаписиВКартотеке", 4);
                                                       
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);   
      ТабличныйДокумент.Вывести(ОбластьСтрока);
      
      ИтогоКоличество = ИтогоКоличество + КоличествоТовара;
      ИтогоСумма = ИтогоСумма + СуммаСНДС;
      
      
      НомерТовара = НомерТовара + 1;  
      Выборка.Следующий();
    КонецЦикла;

    
        
    
    // ОбластьИтогоПоСтранице 
    ПараметрыИтогоПоСтранице = Новый Структура; 
    
    ПараметрыИтогоПоСтранице.Вставить("ИтогоКоличествоНаСтранице", ИтогоКоличество);  
    ПараметрыИтогоПоСтранице.Вставить("ИтогоСуммаНаСтранице", ИтогоСумма);
    
    
    ОбластьИтогоПоСтранице.Параметры.Заполнить(ПараметрыИтогоПоСтранице);   
    ТабличныйДокумент.Вывести(ОбластьИтогоПоСтранице);
    
    // ОбластьВсего 
    ПараметрыВсего = Новый Структура; 
    
    //ПараметрыВсего.Вставить("ИтогоКоличество", 4);  
    //ПараметрыВсего.Вставить("НомерПрейскуранта", 4);
    //ПараметрыВсего.Вставить("ИтогоСуммаСНДС", 4);
    
    
    ОбластьВсего.Параметры.Заполнить(ПараметрыВсего);   
    ТабличныйДокумент.Вывести(ОбластьВсего);
    
    // ОбластьПодвал  
    ПараметрыПодвал = Новый Структура;  
    
    ПараметрыПодвал.Вставить("КоличествоЛистовПродолжения", "1 листе"); 
    //ПараметрыПодвал.Вставить("КоличествоПорядковыхНомеровЗаписейПрописью", 4);
    //ПараметрыПодвал.Вставить("ВсегоНаименований", 4);
    //ПараметрыПодвал.Вставить("ВсегоМестПрописью", 4); 
    //ПараметрыПодвал.Вставить("КоличествоСтрок", 4);
    //ПараметрыПодвал.Вставить("ОтпущеноНаСуммуПрописью", 4);
    //ПараметрыПодвал.Вставить("ОтпускРазрешилДолжность", 4); 
    //ПараметрыПодвал.Вставить("ОтпускПроизвелДолжность", 4);
    //ПараметрыПодвал.Вставить("ФИООтпускРазрешил", 4);
    //ПараметрыПодвал.Вставить("ФИОГлавногоБухгалтера", 4); 
    //ПараметрыПодвал.Вставить("ФИООтпускПроизвел", 4);
    //ПараметрыПодвал.Вставить("НомераБланков", 4);
    //ПараметрыПодвал.Вставить("МассаГрузаНетто", 4); 
    //ПараметрыПодвал.Вставить("МассаГрузаБрутто", 4);
    ПараметрыПодвал.Вставить("ДоверенностьНомер", Номер);
    ПараметрыПодвал.Вставить("ДоверенностьДата", ВыборкаДата);  
    ПараметрыПодвал.Вставить("ДоверенностьВыдана", Выборка.ОрганизацияПредставление + ", " + Выборка.АдресОрганизации);
    //ПараметрыПодвал.Вставить("ГрузПринялДолжность", 4);
    //ПараметрыПодвал.Вставить("ФИОГрузПринял", 4); 
    //ПараметрыПодвал.Вставить("ГрузПолучилДолжность", 4);
    //ПараметрыПодвал.Вставить("ФИОГрузПолучил", 4);
    //ПараметрыПодвал.Вставить("ПроцентНаценки", 4);  
    //ПараметрыПодвал.Вставить("СкладскиеРасходы", 4);
    //ПараметрыПодвал.Вставить("ВсегоКОплате", 4);
    
    

    //ПараметрыМассыПрописью = ПродажиСервер.ПараметрыМассыПрописью(МассаНетто/1000, 1);
    //ОбластьМакета.Параметры.МассаГрузаНеттоПрописью = ЧислоПрописью(
    //ДанныеПечати.МассаНетто/1000*ПараметрыМассыПрописью.Коэффициент,
    //"ДП=Истина",
    //ПараметрыМассыПрописью.Формат);

      ВсегоНаименованийПрописью = ЧислоПрописью(Количество, ,",,,,,,,,0");      
    
    
    ВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();
    
    ИтоговаяСуммаПрописью = РаботаСКурсамиВалют.СформироватьСуммуПрописью(ИтогоСумма, ВалютаРегламентированногоУчета);
    
    ПараметрыПодвал.Вставить("СуммаПрописью", ИтоговаяСуммаПрописью);   
    
    ПараметрыПодвал.Вставить("ВсегоНаименованийПрописью", ВсегоНаименованийПрописью);
    ПараметрыПодвал.Вставить("ВсегоМестПрописью", "Количество: 1 тара: палеты");
    
    ПараметрыПодвал.Вставить("ДолжностьРуководителя", "менеджер");
    ПараметрыПодвал.Вставить("ДолжностьКладовщика", "водитель");
    
    ОбластьПодвал.Параметры.Заполнить(ПараметрыПодвал);   
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
    
    
    
    ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();
    
    // ОбластьТранспортныйРаздел  
    ПараметрыТранспортныйРаздел = Новый Структура;  
    
    ПараметрыТранспортныйРаздел.Вставить("СрокДоставки", ВыборкаДата);  
    ПараметрыТранспортныйРаздел.Вставить("ПредставлениеПеревозчика", Выборка.ОрганизацияПредставление);
    ПараметрыТранспортныйРаздел.Вставить("МаркаАвтомобиля", "");
    ПараметрыТранспортныйРаздел.Вставить("ГосНомерАвтомобиля", "");
    ПараметрыТранспортныйРаздел.Вставить("ПредставлениеЗаказчикаПеревозок", Выборка.КонтрагентПредставление + ", " + Выборка.АдресКонтрагента); 
    ПараметрыТранспортныйРаздел.Вставить("ПредставлениеВодителя", Выборка.Водитель1ФизическоеЛицоФИО);  
        ПараметрыТранспортныйРаздел.Вставить("ВодительскоеУдостоверение", "");  
    ПараметрыТранспортныйРаздел.Вставить("ПунктПогрузки", Выборка.АдресОтправленияАдрес);
    ПараметрыТранспортныйРаздел.Вставить("ПунктРазгрузки", Выборка.АдресНазначенияАдрес);
    ПараметрыТранспортныйРаздел.Вставить("НомерДокумента", Номер);  
    ПараметрыТранспортныйРаздел.Вставить("НомерЛистаПутевого", ""); 
             
    ПараметрыТранспортныйРаздел.Вставить("МаркаАвтомобиля", Выборка.ТСМарка); 
    ПараметрыТранспортныйРаздел.Вставить("ГосНомерАвтомобиля", Выборка.ТСГосударственныйНомерПрицепа);
    
    
    ОбластьТранспортныйРаздел.Параметры.Заполнить(ПараметрыТранспортныйРаздел);   
    ТабличныйДокумент.Вывести(ОбластьТранспортныйРаздел);
    
    
    
    // ОбластьСведенияОГрузе  
    
      
      // ОбластьПодвалСведенийОГрузе  
    
    ПараметрыСведенийОГрузе = Новый Структура;  
    ТН = "ТН " + Номер + " от " + ВыборкаДата; 
    
    ПараметрыСведенийОГрузе.Вставить("НаименованиеГруза", "");  
    ПараметрыСведенийОГрузе.Вставить("ТН", Номер);  
    ПараметрыСведенийОГрузе.Вставить("СФ", Номер);  

    ПараметрыСведенийОГрузе.Вставить("КолМест", ИтогоКоличество); 
    
    
    ОбластьСведенияОГрузе.Параметры.Заполнить(ПараметрыСведенийОГрузе);   
    
    ТабличныйДокумент.Вывести(ОбластьСведенияОГрузе);
    
    ТабличныйДокумент.Вывести(ОбластьПодвалСведенийОГрузе);
    
    // ОбластьПогрузочныеОперации 
    
    ТабличныйДокумент.Вывести(ОбластьПогрузочныеОперации);
    
    
    // ОбластьПрочиеСведения  
    
    ТабличныйДокумент.Вывести(ОбластьПрочиеСведения);
    
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуТоварнаяНакладная(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  ТабличныйДокумент.ПолеСлева = 5;
  ТабличныйДокумент.ПолеСправа = 5;
  ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  ТабличныйДокумент.АвтоМасштаб = Истина;
  ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ТОРГ12_2_МОДИФИЦИРОВАННЫЙ";
    
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  
  
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  НомерСтраницы = 1;
  
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда     
      Макет = ПолучитьМакет("ТоварнаяНакладная");
      
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка");      
      ОбластьЗаголовокТаб = Макет.ПолучитьОбласть("ЗаголовокТаб");
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьИтогоПоСтранице = Макет.ПолучитьОбласть("ИтогоПоСтранице");
      ОбластьВсего = Макет.ПолучитьОбласть("Всего");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      
      ПервыйДокумент = Ложь;
      
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    
    // ОбластьШапки 
    ПараметрыШапки = Новый Структура;
    
    ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьШапка, Выборка.Ссылка);
    
    
    Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(Выборка.Номер);
    Дата = Выборка.Дата;
    
    ПредставлениеОрганизации = Выборка.ОрганизацияНаименованиеПолное + ", ИНН " + Выборка.ОрганизацияИНН + ", " + Выборка.АдресОрганизации + ", тел.: " + Выборка.ТелефонОрганизации;
    ПредставлениеКонтрагента = Выборка.КонтрагентНаименованиеПолное + ", ИНН " + Выборка.КонтрагентИНН + ", " + Выборка.АдресКонтрагента;
    
    ПараметрыШапки.Вставить("ПредставлениеОрганизации", ПредставлениеОрганизации);  
    ПараметрыШапки.Вставить("ПредставлениеПодразделения", Выборка.ПодразделениеПредставление);
    ПараметрыШапки.Вставить("ПредставлениеГрузополучателя", ПредставлениеКонтрагента);   
    ПараметрыШапки.Вставить("АдресДоставки",Выборка.АдресДоставки);
    ПараметрыШапки.Вставить("ПредставлениеПоставщика",ПредставлениеОрганизации);   
    ПараметрыШапки.Вставить("ПредставлениеПлательщика", ПредставлениеКонтрагента);  
    
    ПараметрыШапки.Вставить("Основание", "Заказ клиента № " + Номер + " от " + Формат(Дата, "ДЛФ=ДД")); 
    
    ПараметрыШапки.Вставить("НомерДокумента", Номер); 
    ПараметрыШапки.Вставить("ОрганизацияПоОКПО", Выборка.ОрганизацияКодПоОКПО);
    //ПараметрыШапки.Вставить("ВидДеятельностиПоОКДП", Выборка.Дата);
    //ПараметрыШапки.Вставить("ГрузополучательПоОКПО", Выборка.КонтрагентКодПоОКПО);
    //ПараметрыШапки.Вставить("ПоставщикПоОКПО", Выборка.ОрганизацияКодПоОКПО);
    //ПараметрыШапки.Вставить("ПлательщикПоОКПО", Выборка.КонтрагентКодПоОКПО);
    //ПараметрыШапки.Вставить("ОснованиеНомер", Номер);
    //ПараметрыШапки.Вставить("ОснованиеДата", Дата);
    //
    //ПараметрыШапки.Вставить("ДатаДокумента", Дата);
    
    //ПараметрыШапки.Вставить("ТранспортнаяНакладнаяНомер", Номер);
    //ПараметрыШапки.Вставить("ТранспортнаяНакладнаяДата", Выборка.Дата);
    //ПараметрыШапки.Вставить("ВидОперации", Выборка.Дата);
    
    
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапки);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    
    // ОбластьЗаголовокТаб  
    ПараметрыЗаголовокТаб = Новый Структура;    
    
    ПараметрыЗаголовокТаб.Вставить("НомерСтраницы", "Страница " + НомерСтраницы); 
    
    
    ОбластьЗаголовокТаб.Параметры.Заполнить(ПараметрыЗаголовокТаб);   
    ТабличныйДокумент.Вывести(ОбластьЗаголовокТаб);
    
    
    
    // ОбластьСтрока  
    ПараметрыСтрока = Новый Структура;  
    
    ПервыйТовар = Истина;
    НомерТовара = 1;    
    
    ИтогоКоличествоНаСтранице = 0;
    ИтогоСуммаБезНДСНаСтранице = 0;
    ИтогоСуммаНДСНаСтранице = 0;
    ИтогоСуммаСНДСНаСтранице = 0;
    ИтогоМассаНетто = 0;
    ИтогоКоличествоМест = 0;
    
    Количество = Выборка.КоличествоТоваров;
    
    Пока НомерТовара <= Количество Цикл 
      
      Цена = Выборка.СуммаСНДС - Выборка.СуммаНДС;
      
      Упаковка = "уп";
      //ТипУпаковки = Выборка.УпаковкаТипУпаковки;
      //Если ЗначениеЗаполнено(ТипУпаковки) Тогда
      //  Упаковка = ТипУпаковки;
      //КонецЕсли;
      
      СтавкаНДС = Формат(Выборка.СтавкаНДССтавка, "ЧДЦ=2");
      
      КоличествоТовара = Формат(Выборка.Количество, "ЧДЦ=2");     
      
      МассаНетто = Число(Выборка.НоменклатураВесЧислитель);
      
      ПараметрыСтрока.Вставить("НомерСтроки", НомерТовара); 
      ПараметрыСтрока.Вставить("ПредставлениеНоменклатуры", Выборка.НоменклатураПредставление);
      //ПараметрыСтрока.Вставить("НоменклатураКод",Выборка.НоменклатураКод);
      ПараметрыСтрока.Вставить("ЕдиницаИзмеренияНаименование",Выборка.НоменклатураЕдиницаИзмеренияНаименование);
      //ПараметрыСтрока.Вставить("ЕдиницаИзмеренияКод",Выборка.НоменклатураЕдиницаИзмеренияКод);
      //ПараметрыСтрока.Вставить("ВидУпаковки", Упаковка);
      //ПараметрыСтрока.Вставить("КоличествоВОдномМесте", Выборка.УпаковкаЕдиницаИзмеренияКоличествоУпаковок);
      //ПараметрыСтрока.Вставить("КоличествоМест", 1);
      ПараметрыСтрока.Вставить("МассаНетто", Строка(МассаНетто));
      ПараметрыСтрока.Вставить("Количество", КоличествоТовара);
      ПараметрыСтрока.Вставить("Цена", Цена);
      ПараметрыСтрока.Вставить("СуммаБезНДС", Цена);
      ПараметрыСтрока.Вставить("СтавкаНДС",Выборка.СтавкаНДССтавка);
      ПараметрыСтрока.Вставить("СуммаНДС",Выборка.СуммаНДС);
      ПараметрыСтрока.Вставить("СуммаСНДС",Выборка.СуммаСНДС);
      
      
      
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);   
      ТабличныйДокумент.Вывести(ОбластьСтрока);
      
      ИтогоМассаНетто = ИтогоМассаНетто + МассаНетто;
      //ИтогоКоличествоМест = ИтогоКоличествоМест + 1;

      ИтогоКоличествоНаСтранице = ИтогоКоличествоНаСтранице + КоличествоТовара;
      ИтогоСуммаБезНДСНаСтранице = ИтогоСуммаБезНДСНаСтранице + Выборка.Цена;
      ИтогоСуммаНДСНаСтранице = ИтогоСуммаНДСНаСтранице + Выборка.СуммаНДС;
      ИтогоСуммаСНДСНаСтранице = ИтогоСуммаСНДСНаСтранице + Выборка.СуммаСНДС;
      
      НомерТовара = НомерТовара + 1;
      Выборка.Следующий();
    КонецЦикла;
    
    
    
    
    
    // ОбластьИтогоПоСтранице 
    ПараметрыИтогоПоСтранице = Новый Структура;
    
    ИтогоКоличествоНаСтранице = Формат(ИтогоКоличествоНаСтранице, "ЧДЦ=2");
    
    ПараметрыИтогоПоСтранице.Вставить("ИтогоКоличествоМестНаСтранице", Строка(ИтогоКоличествоМест));  
    ПараметрыИтогоПоСтранице.Вставить("ИтогоМассаБруттоНаСтранице", Строка(ИтогоМассаНетто));
    ПараметрыИтогоПоСтранице.Вставить("ИтогоКоличествоНаСтранице", ИтогоКоличествоНаСтранице);
    ПараметрыИтогоПоСтранице.Вставить("ИтогоСуммаБезНДСНаСтранице", ИтогоСуммаБезНДСНаСтранице);
    ПараметрыИтогоПоСтранице.Вставить("ИтогоСуммаНДСНаСтранице", ИтогоСуммаНДСНаСтранице);
    ПараметрыИтогоПоСтранице.Вставить("ИтогоСуммаСНДСНаСтранице", ИтогоСуммаСНДСНаСтранице);
    
    
    
    ОбластьИтогоПоСтранице.Параметры.Заполнить(ПараметрыИтогоПоСтранице);   
    ТабличныйДокумент.Вывести(ОбластьИтогоПоСтранице);
    
    
    // ОбластьВсего 
    ПараметрыВсего = Новый Структура;   
    
    //ПараметрыВсего.Вставить("ИтогоКоличествоМест", Строка(ИтогоКоличествоМест));  
    //ПараметрыВсего.Вставить("ИтогоМассаБрутто", Строка(ИтогоВесБрутто));
    //ПараметрыВсего.Вставить("ИтогоКоличество", ИтогоКоличествоНаСтранице);
    //ПараметрыВсего.Вставить("ИтогоСуммаБезНДС", ИтогоСуммаБезНДСНаСтранице);
    //ПараметрыВсего.Вставить("ИтогоСуммаНДС", ИтогоСуммаНДСНаСтранице);
    ПараметрыВсего.Вставить("ИтогоСуммаСНДС", ИтогоСуммаСНДСНаСтранице);
    
    
    
    ОбластьВсего.Параметры.Заполнить(ПараметрыВсего);   
    ТабличныйДокумент.Вывести(ОбластьВсего);
    
    
    
    // ОбластьПодвал  
    ПараметрыПодвал = Новый Структура;    
    
    //ПараметрыПодвал.Вставить("КоличествоЛистовВПриложении", 1); 
    //ПараметрыПодвал.Вставить("КоличествоПорядковыхНомеровЗаписейПрописью", 1);
    //ПараметрыПодвал.Вставить("МассаНеттоПрописью", 1);
    //ПараметрыПодвал.Вставить("ВсегоМестПрописью", 1);
    //ПараметрыПодвал.Вставить("МассаБруттоПрописью", 1);
    ПараметрыПодвал.Вставить("ДолжностьРуководителя", "Специалист по заказам");
    ПараметрыПодвал.Вставить("ФИОРуководителя", Выборка.РуководительФизическоеЛицоФИО);
    ПараметрыПодвал.Вставить("ФИОГлавБухгалтера", Выборка.ГлавныйБухгалтерФизическоеЛицоФИО);
    ПараметрыПодвал.Вставить("ДолжностьКладовщика", "Специалист по заказам");
    ПараметрыПодвал.Вставить("ФИОКладовщика", "");
    
    ПолнаяДатаДокумента = СтрЗаменить(Формат(Дата, "ДЛФ=DD"),
    НСтр("ru = 'г.';
    |en = 'year'", Метаданные.Языки.Русский.КодЯзыка),
    НСтр("ru = 'года';
    |en = 'year'", Метаданные.Языки.Русский.КодЯзыка));
    ДлинаСтроки = СтрДлина(ПолнаяДатаДокумента);
    ПервыйРазделитель = СтрНайти(ПолнаяДатаДокумента, " ");
    ВторойРазделитель = СтрНайти(Прав(ПолнаяДатаДокумента, ДлинаСтроки - ПервыйРазделитель), " ") + ПервыйРазделитель;
    
    ПараметрыПодвал.Вставить("ДатаДокументаДень", """" + Лев(ПолнаяДатаДокумента, ПервыйРазделитель -1 ) + """");
    ПараметрыПодвал.Вставить("ДатаДокументаМесяц", Сред(ПолнаяДатаДокумента, ПервыйРазделитель + 1, ВторойРазделитель - ПервыйРазделитель - 1));
    ПараметрыПодвал.Вставить("ДатаДокументаГод", Прав(ПолнаяДатаДокумента, ДлинаСтроки - ВторойРазделитель));
    
    ВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();
    
    СуммаПрописью = РаботаСКурсамиВалют.СформироватьСуммуПрописью(ИтогоСуммаСНДСНаСтранице, ВалютаРегламентированногоУчета);
    ПараметрыПодвал.Вставить("СуммаПрописью", СуммаПрописью);
    
    
    
  //  Если ИтогоКоличествоМест > 0 Тогда
  //  ПараметрыПодвал.Вставить("ВсегоМестПрописью", ЧислоПрописью(ИтогоКоличествоМест, ,",,,,,,,,0"));
  //КонецЕсли;
  //
  Если ИтогоМассаНетто > 0 Тогда
    ПараметрыМассыПрописью = ПродажиСервер.ПараметрыМассыПрописью(ИтогоМассаНетто, 0.001);
    ПараметрыПодвал.Вставить("МассаНеттоПрописью", ЧислоПрописью(
      ИтогоМассаНетто * ПараметрыМассыПрописью.Коэффициент,
      "ДП=Истина",
      ПараметрыМассыПрописью.Формат));
  КонецЕсли;
  
  //Если ИтоговыеСуммы.ИтогоМассаБрутто > 0 Тогда
  //  ПараметрыМассыПрописью = ПродажиСервер.ПараметрыМассыПрописью(ИтоговыеСуммы.ИтогоМассаБрутто, КоэффициентПересчетаВТонны);
  //  СтруктураПараметров.Вставить("МассаБруттоПрописью", ЧислоПрописью(
  //    ИтоговыеСуммы.ИтогоМассаБрутто * ПараметрыМассыПрописью.Коэффициент,
  //    "ДП=Истина",
  //    ПараметрыМассыПрописью.Формат));
  //КонецЕсли;

    
    //ПараметрыПодвал.Вставить("СуммаПрописью", 1);
    //ПараметрыПодвал.Вставить("ДоверенностьНомер", 1);
    //ПараметрыПодвал.Вставить("ДоверенностьДата", 1);
    //ПараметрыПодвал.Вставить("ДоверенностьЧерезКого", 1);
    //ПараметрыПодвал.Вставить("ДоверенностьВыдана", 1);
    
    ПараметрыПодвал.Вставить("МассаНеттоПрописью", ПараметрыМассыПрописью);
    
    ОбластьПодвал.Параметры.Заполнить(ПараметрыПодвал);   
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
    НомерСтраницы = НомерСтраницы + 1;
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуДоверенность(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  //ТабличныйДокумент.ПолеСлева = 5;
  //ТабличныйДокумент.ПолеСправа = 5;
  //ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  //ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  //ТабличныйДокумент.АвтоМасштаб = Истина;
  //ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПРИЛОЖЕНИЕ_К_НАКЛАДНОЙ";
  
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | ЗаказКлиента.БанковскийСчетКонтрагента.НомерСчета КАК БанковскийСчетКонтрагентаНомерСчета,
  | ЗаказКлиента.БанковскийСчетКонтрагента.Банк.Наименование КАК БанковскийСчетКонтрагентаБанкНаименование,
  | ЗаказКлиента.Организация.ОГРН КАК ОрганизацияОГРН
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | ОрганизацииКонтактнаяИнформация.Город КАК Город,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияГород
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Фактический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП,
  | втЗаказКлиента.БанковскийСчетКонтрагентаНомерСчета КАК БанковскийСчетКонтрагентаНомерСчета,
  | втЗаказКлиента.БанковскийСчетКонтрагентаБанкНаименование КАК БанковскийСчетКонтрагентаБанкНаименование,
  | втОрганизацияГород.Город КАК Город,
  | втЗаказКлиента.ОрганизацияОГРН КАК ОрганизацияОГРН
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияГород КАК втОрганизацияГород
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияГород.Ссылка1";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  //НомерСтраницы = 1;
  
  
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда     
      
      Макет = ПолучитьМакет("Доверенность");
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка"); 
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      
      ПервыйДокумент = Ложь;
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    
    
    ВыборкаДата = Формат (ТекущаяДата(), "ДФ=dd.MM.yyyy");
    
    НомерВВидеСтроки = Выборка.Номер;
    ДлинаНомера = СтрДлина(НомерВВидеСтроки);
    НачалоЧисловойЧасти = ДлинаНомера - 5;
    НомерВВидеЦифр = Сред(НомерВВидеСтроки, НачалоЧисловойЧасти, 6);
    
    Для Индекс = 0 По СтрДлина(НомерВВидеЦифр) Цикл
      Если Сред(НомерВВидеЦифр, Индекс, 1) <> "0" Тогда   
        Прервать;
      КонецЕсли;      
    КонецЦикла;
    
    Номер = Сред(НомерВВидеЦифр, Индекс, ДлинаНомера - Индекс);
    
    
    // ОбластьШапка     
    ПараметрыШапка = Новый Структура;
    ПараметрыШапка.Вставить("НомерДоверенности", Номер);  
    ПараметрыШапка.Вставить("Город", Выборка.Город);  
    ПараметрыШапка.Вставить("Дата", ВыборкаДата); 
    ПараметрыШапка.Вставить("адрес", Выборка.АдресОрганизации); 
    ПараметрыШапка.Вставить("НаименованиеОрганизации", Выборка.ОрганизацияНаименованиеПолное);  
    ПараметрыШапка.Вставить("ГенДир", Выборка.РуководительФизическоеЛицоФИО); 
    ПараметрыШапка.Вставить("Поверенный", "");  
    ПараметрыШапка.Вставить("ИНН", Выборка.ОрганизацияИНН); 
    ПараметрыШапка.Вставить("ОГРН", Выборка.ОрганизацияОГРН); 
    
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    
    //ПараметрыПодвал = Новый Структура;
    ПараметрыПодвал = Новый Структура;
    ПараметрыПодвал.Вставить("ГенДир", Выборка.РуководительФизическоеЛицоФИО);  
    ПараметрыПодвал.Вставить("Поверенный", ""); 
    
    ОбластьПодвал.Параметры.Заполнить(ПараметрыПодвал);
    
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
    
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуДоверенностьСТаблицей(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  //ТабличныйДокумент.ПолеСлева = 5;
  //ТабличныйДокумент.ПолеСправа = 5;
  //ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  //ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  //ТабличныйДокумент.АвтоМасштаб = Истина;
  //ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПРИЛОЖЕНИЕ_К_НАКЛАДНОЙ";
  
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | ЗаказКлиента.БанковскийСчетКонтрагента.НомерСчета КАК БанковскийСчетКонтрагентаНомерСчета,
  | ЗаказКлиента.БанковскийСчетКонтрагента.Банк.Наименование КАК БанковскийСчетКонтрагентаБанкНаименование,
  | ЗаказКлиента.Организация.ОГРН КАК ОрганизацияОГРН
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | ОрганизацииКонтактнаяИнформация.Город КАК Город,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияГород
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Фактический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП,
  | втЗаказКлиента.БанковскийСчетКонтрагентаНомерСчета КАК БанковскийСчетКонтрагентаНомерСчета,
  | втЗаказКлиента.БанковскийСчетКонтрагентаБанкНаименование КАК БанковскийСчетКонтрагентаБанкНаименование,
  | втОрганизацияГород.Город КАК Город,
  | втЗаказКлиента.ОрганизацияОГРН КАК ОрганизацияОГРН
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияГород КАК втОрганизацияГород
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияГород.Ссылка1";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 

  //НомерСтраницы = 1;
  
  
  Пока Выборка.Следующий() Цикл     
  
    Если ПервыйДокумент Тогда     

    Макет = ПолучитьМакет("ДоверенностьСТаблицей");
          Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
  

      ОбластьШапка = Макет.ПолучитьОбласть("Документ"); 
      //ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      
      ПервыйДокумент = Ложь;
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
      
  ВыборкаДата = Формат (Выборка.Дата, "ДФ=dd.MM.yyyy");
  
  НомерВВидеСтроки = Выборка.Номер;
    ДлинаНомера = СтрДлина(НомерВВидеСтроки);
    НачалоЧисловойЧасти = ДлинаНомера - 5;
    НомерВВидеЦифр = Сред(НомерВВидеСтроки, НачалоЧисловойЧасти, 6);
    
    Для Индекс = 0 По СтрДлина(НомерВВидеЦифр) Цикл
      Если Сред(НомерВВидеЦифр, Индекс, 1) <> "0" Тогда   
        Прервать;
      КонецЕсли;      
    КонецЦикла;
    
    Номер = Сред(НомерВВидеЦифр, Индекс, ДлинаНомера - Индекс);   
  
    // ОбластьШапка     
    ПараметрыШапка = Новый Структура;
    ПараметрыШапка.Вставить("ОКУД", "0315001"); 
    ПараметрыШапка.Вставить("ОПКО", "23455387");  
    ПараметрыШапка.Вставить("ИНН", Выборка.ОрганизацияИНН); 
    ПараметрыШапка.Вставить("Организация", Выборка.КонтрагентПредставление);  
    ПараметрыШапка.Вставить("ДатаВыдачи", ВыборкаДата); 
    ПараметрыШапка.Вставить("ДатаОкончЛицензии", Строка(Формат (Выборка.Дата + 24*3600, "ДФ=dd.MM.yyyy"))); 
    ПараметрыШапка.Вставить("НаименованиеПотребителя", Выборка.КонтрагентНаименованиеПолное); 
    ПараметрыШапка.Вставить("АдресПотребителя", Выборка.АдресКонтрагента);  
    ПараметрыШапка.Вставить("Счет", Выборка.БанковскийСчетКонтрагентаНомерСчета); 
    ПараметрыШапка.Вставить("НаименованиеБанка", Выборка.БанковскийСчетКонтрагентаБанкНаименование);  
    ПараметрыШапка.Вставить("должность", ""); 
    ПараметрыШапка.Вставить("ФИО", ""); 
    ПараметрыШапка.Вставить("серияПаспорта", ""); 
    ПараметрыШапка.Вставить("номерПаспорта", ""); 
    ПараметрыШапка.Вставить("КемВыданПаспорт", ""); 
    ПараметрыШапка.Вставить("ДатаВыдачиПас", ""); 
    ПараметрыШапка.Вставить("НаименованиеОрганизации", Выборка.ОрганизацияПредставление); 
    ПараметрыШапка.Вставить("адресОрганизации", Выборка.АдресОрганизации);  
    ПараметрыШапка.Вставить("Руководитель", "");  
    ПараметрыШапка.Вставить("Адрес", Выборка.АдресОрганизации); 

    ПараметрыШапка.Вставить("НомДоверености", Номер); 
    ПараметрыШапка.Вставить("СрокДействия", ВыборкаДата); 
    ПараметрыШапка.Вставить("ДолжностьИФамилия", ""); 
    ПараметрыШапка.Вставить("Расписка", "");  
    ПараметрыШапка.Вставить("Поставщик", Выборка.ОрганизацияПредставление); 
    ПараметрыШапка.Вставить("НомерИДатаДокумента", ""); 
    ПараметрыШапка.Вставить("НомерИДатаНаряда", "");  
    
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
      

  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуУдостоверениеОКачестве(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  //ТабличныйДокумент.ПолеСлева = 5;
  //ТабличныйДокумент.ПолеСправа = 5;
  //ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  //ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  //ТабличныйДокумент.АвтоМасштаб = Истина;
  //ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПРИЛОЖЕНИЕ_К_НАКЛАДНОЙ";
  
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  //НомерСтраницы = 1;
  
  
  
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда     
      
      Макет = ПолучитьМакет("УдостоверениеОКачестве");
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка"); 
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      ОбластьДата = Макет.ПолучитьОбласть("Дата");

      ПервыйДокумент = Ложь;
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    
    ВыборкаДата = Формат(Выборка.Дата, "ДЛФ=DD");
    
    НомерВВидеСтроки = Выборка.Номер;
    ДлинаНомера = СтрДлина(НомерВВидеСтроки);
    НачалоЧисловойЧасти = ДлинаНомера - 5;
    НомерВВидеЦифр = Сред(НомерВВидеСтроки, НачалоЧисловойЧасти, 6);
    
    Для Индекс = 0 По СтрДлина(НомерВВидеЦифр) Цикл
      Если Сред(НомерВВидеЦифр, Индекс, 1) <> "0" Тогда   
        Прервать;
      КонецЕсли;      
    КонецЦикла;
    
    Номер = Сред(НомерВВидеЦифр, Индекс, ДлинаНомера - Индекс);

    
    // ОбластьШапка     
    ПараметрыШапка = Новый Структура;
    ПараметрыШапка.Вставить("НомерУдостоверения", Номер); 
    ПараметрыШапка.Вставить("Дата", ВыборкаДата); 
    ПараметрыШапка.Вставить("НаименованиеОрганаСертификации", "");  
    ПараметрыШапка.Вставить("АдресОрганаСертификации", ""); 
    ПараметрыШапка.Вставить("Поставщик", Выборка.ОрганизацияНаименованиеПолное);  
    ПараметрыШапка.Вставить("АдресПоставщика", Выборка.АдресОрганизации); 
    ПараметрыШапка.Вставить("Получатель", Выборка.КонтрагентНаименованиеПолное);  
    ПараметрыШапка.Вставить("ФамилияЭкспедитора", "");  
    ПараметрыШапка.Вставить("НомерТТН", Номер); 
    ПараметрыШапка.Вставить("ДатаВыработки", ВыборкаДата);  
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    
    // ОбластьСтрока  
    
    НомерТовара = 1;
    Количество = Выборка.КоличествоТоваров;
    
    Пока НомерТовара <= Количество Цикл 
      
      
      ПараметрыСтрока = Новый Структура;
      //ПараметрыСтрока.Вставить("НаименованиеРод", "Не ясно, откуда брать");
      ПараметрыСтрока.Вставить("Наименование", Выборка.НоменклатураНаименование);
      ПараметрыСтрока.Вставить("ДатаВыработки", ВыборкаДата);
      ПараметрыСтрока.Вставить("Время", "04-00");
      ПараметрыСтрока.Вставить("Срок", "");
      ПараметрыСтрока.Вставить("УсловияХранения", "");
      ПараметрыСтрока.Вставить("ДекларацияСоответствия", "");
      ПараметрыСтрока.Вставить("нтд", "");
      
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);
      ТабличныйДокумент.Вывести(ОбластьСтрока);
      
      
      НомерТовара = НомерТовара + 1;  
      Выборка.Следующий();
    КонецЦикла;
    
    ПараметрыДата = Новый Структура;
    ПараметрыДата.Вставить("Дата", ВыборкаДата);        
    
    ОбластьДата.Параметры.Заполнить(ПараметрыДата);
    ТабличныйДокумент.Вывести(ОбластьДата);
      
    ПараметрыПодвал = Новый Структура;
    ПараметрыПодвал.Вставить("Изготовитель", "ООО ПТО Кондитерский ДОМ");
    ПараметрыПодвал.Вставить("АдресИзготовителя", Выборка.АдресОрганизации);
    ПараметрыПодвал.Вставить("ГенДиректор", "Медведев М.Б.");
    ПараметрыПодвал.Вставить("ГлТехнолог", "Литовкина Н.М.");
    
    ОбластьПодвал.Параметры.Заполнить(ПараметрыПодвал);
    
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
    
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуЧекЛист(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  //ТабличныйДокумент.ПолеСлева = 5;
  //ТабличныйДокумент.ПолеСправа = 5;
  //ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  //ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  //ТабличныйДокумент.АвтоМасштаб = Истина;
  //ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПРИЛОЖЕНИЕ_К_НАКЛАДНОЙ";
  
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  //НомерСтраницы = 1;
  
    
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда     
      
      Макет = ПолучитьМакет("ЧекЛист");
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка"); 
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      
      ПервыйДокумент = Ложь;
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    
    ВыборкаДата = Формат (Выборка.Дата, "ДФ=dd.MM.yyyy");
    
    ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьШапка, Выборка.Ссылка);
    
    НомерВВидеСтроки = Выборка.Номер;
    ДлинаНомера = СтрДлина(НомерВВидеСтроки);
    НачалоЧисловойЧасти = ДлинаНомера - 5;
    НомерВВидеЦифр = Сред(НомерВВидеСтроки, НачалоЧисловойЧасти, 6);
    
    Для Индекс = 0 По СтрДлина(НомерВВидеЦифр) Цикл
      Если Сред(НомерВВидеЦифр, Индекс, 1) <> "0" Тогда   
        Прервать;
      КонецЕсли;      
    КонецЦикла;
    
    Номер = Сред(НомерВВидеЦифр, Индекс, ДлинаНомера - Индекс);
    
    
    // ОбластьШапка     
    ПараметрыШапка = Новый Структура;
    ПараметрыШапка.Вставить("Сеть", Выборка.КонтрагентПредставление); 
    ПараметрыШапка.Вставить("АдресСети", Выборка.АдресДоставки);  
    ПараметрыШапка.Вставить("ЛимитДоверенности", ""); 
    ПараметрыШапка.Вставить("Код", Номер);  
    ПараметрыШапка.Вставить("Дата", ВыборкаДата); 
    
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    
    
    НомерТовара = 1;
    Количество = Выборка.КоличествоТоваров;
    
    
    ПараметрыСтрока = Новый Структура;
    ИтогоМест = 0;  
    Пока НомерТовара <= Количество Цикл   
      ШК = "";
      Штрихкод = Строка(Выборка.Штрихкод);
      ШтрихкодКоличество = СтрДлина(Штрихкод);
      ШК = Сред(Штрихкод, ШтрихкодКоличество - 3, ШтрихкодКоличество);
      
      ПараметрыСтрока.Вставить("НаименованиеИСрокХранения", Выборка.НоменклатураНаименование);
      ПараметрыСтрока.Вставить("ШК", ШК);
      ПараметрыСтрока.Вставить("Количество", Выборка.Количество);
      
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);
      ТабличныйДокумент.Вывести(ОбластьСтрока);
      
      
      НомерТовара = НомерТовара + 1;
      ИтогоМест = ИтогоМест + Выборка.Количество;
      Выборка.Следующий();
      
    КонецЦикла;
    
    Водитель = "";      
    Если ЗначениеЗаполнено(Выборка.Водитель1ФизическоеЛицоФИО) Тогда
      Если ЗначениеЗаполнено(Выборка.Водитель2ФизическоеЛицоФИО) Тогда        
        Водитель = Строка(Выборка.Водитель1ФизическоеЛицоФИО) + ", " + Строка(Выборка.Водитель2ФизическоеЛицоФИО);
      Иначе
        Водитель = Строка(Выборка.Водитель1ФизическоеЛицоФИО);
      КонецЕсли;  
    ИначеЕсли ЗначениеЗаполнено(Выборка.Водитель2ФизическоеЛицоФИО) Тогда
      Водитель = Строка(Выборка.Водитель2ФизическоеЛицоФИО);
    КонецЕсли;
    
    ПараметрыПодвал = Новый Структура;
    ПараметрыПодвал.Вставить("ИтогоМест", ИтогоМест);
    ПараметрыПодвал.Вставить("ИтогоЛотков", "");
    ПараметрыПодвал.Вставить("Водитель", Водитель);
    ПараметрыПодвал.Вставить("ДатаНач", Выборка.НоменклатураАртикул);
    ПараметрыПодвал.Вставить("ДатаКон", Выборка.НоменклатураАртикул);
    ПараметрыПодвал.Вставить("Перевозчик", "");
    ПараметрыПодвал.Вставить("Маршрут", Выборка.МаршрутНомерМаршрута);
    ПараметрыПодвал.Вставить("Кластер", "");
    
    ОбластьПодвал.Параметры.Заполнить(ПараметрыПодвал);
    
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
    
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуПриложениеКТоварнойНакладной(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  ТабличныйДокумент.АвтоМасштаб = Истина;
  ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПРИЛОЖЕНИЕ_К_НАКЛАДНОЙ"; 
  
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  //НомерСтраницы = 1;
  
  Пока Выборка.Следующий() Цикл     
    
    
    Если ПервыйДокумент Тогда     
      
      Макет = ПолучитьМакет("ПриложениеКТоварнойНакладной");
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка"); 
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      
      ПервыйДокумент = Ложь;
      
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
      
    КонецЕсли;
    
    ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьШапка, Выборка.Ссылка);
    
    
    ВыборкаДата = Формат (Выборка.Дата, "ДФ=dd.MM.yyyy");
    
    
    //Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(Выборка.Номер);
    
    ПоставщикСАдресом = Выборка.ОрганизацияПредставление + ", " + Выборка.АдресОрганизации;
    ПоставщикСАдресомИТелефоном = ПоставщикСАдресом + ", " + Выборка.ТелефонОрганизации;
    
    // ОбластьШапка     
    ПараметрыШапка = Новый Структура;
    ПараметрыШапка.Вставить("ПоставщикСАдресом", ПоставщикСАдресом);  
    ПараметрыШапка.Вставить("ПоставщикСАдресомИТелефоном", ПоставщикСАдресомИТелефоном);  
    
    НомерВВидеСтроки = Выборка.Номер;
    ДлинаНомера = СтрДлина(НомерВВидеСтроки);
    НачалоЧисловойЧасти = ДлинаНомера - 5;
    НомерВВидеЦифр = Сред(НомерВВидеСтроки, НачалоЧисловойЧасти, 6);
    
    Для Индекс = 0 По СтрДлина(НомерВВидеЦифр) Цикл
      Если Сред(НомерВВидеЦифр, Индекс, 1) <> "0" Тогда   
        Прервать;
      КонецЕсли;      
    КонецЦикла;
    
    Номер = Сред(НомерВВидеЦифр, Индекс, ДлинаНомера - Индекс);   
    
    ПараметрыШапка.Вставить("НомерПриложения", Номер);  
    ПараметрыШапка.Вставить("ДатаНакладной", ВыборкаДата);  
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    
    НомерТовара = 1;
    
    Количество = Выборка.КоличествоТоваров;
    
    Пока НомерТовара <= Количество Цикл 
      
      // ОбластьСтрокаТаблицы     
      ПараметрыСтрока = Новый Структура;
      ПараметрыСтрока.Вставить("НомерСтроки", НомерТовара);
      ПараметрыСтрока.Вставить("Артикул", Выборка.НоменклатураАртикул);
      ПараметрыСтрока.Вставить("Наименование", Выборка.НоменклатураНаименование);
      ПараметрыСтрока.Вставить("НомерСертификата", "");
      ПараметрыСтрока.Вставить("ИзготовительСертификата", "ООО Кондитерский ДОМ");
      ПараметрыСтрока.Вставить("ОрганПоСертификацииСертификата", "");
      ПараметрыСтрока.Вставить("СрокДействияСертификата", "");
      ПараметрыСтрока.Вставить("НомерДекларации", "");
      ПараметрыСтрока.Вставить("ОрганПоСертификацииДекларации", "");
      ПараметрыСтрока.Вставить("СрокДействияДекларации", "");
      
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);
      ТабличныйДокумент.Вывести(ОбластьСтрока);
            
      НомерТовара = НомерТовара + 1;  
      Выборка.Следующий();
    КонецЦикла;
    
    
    
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуПриложениеКНакладной(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  //ТабличныйДокумент.ПолеСлева = 5;
  //ТабличныйДокумент.ПолеСправа = 5;
  //ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  //ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  ТабличныйДокумент.АвтоМасштаб = Истина;
  ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПРИЛОЖЕНИЕ_К_НАКЛАДНОЙ";
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  //НомерСтраницы = 1;
  
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда
      
      Макет = ПолучитьМакет("ПриложениеКНакладной");
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
            
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка"); 
      ОбластьЗаголовокТаблицы = Макет.ПолучитьОбласть("ЗаголовокТаблицы"); 
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьШапкаРасшифровка = Макет.ПолучитьОбласть("ШапкаРасшифровка");
      ОбластьСтрокаРасшифровки = Макет.ПолучитьОбласть("СтрокаРасшифровки");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
            
      ПервыйДокумент = Ложь;
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьШапка, Выборка.Ссылка);
  
    ВыборкаДата = Формат (Выборка.Дата, "ДФ=dd.MM.yyyy");
    
    // Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(Выборка.Номер);      

    НомерВВидеСтроки = Выборка.Номер;
    ДлинаНомера = СтрДлина(НомерВВидеСтроки);
    НачалоЧисловойЧасти = ДлинаНомера - 5;
    НомерВВидеЦифр = Сред(НомерВВидеСтроки, НачалоЧисловойЧасти, 6);
    
    Для Индекс = 0 По СтрДлина(НомерВВидеЦифр) Цикл
      Если Сред(НомерВВидеЦифр, Индекс, 1) <> "0" Тогда   
        Прервать;
      КонецЕсли;      
    КонецЦикла;
    
    Номер = Сред(НомерВВидеЦифр, Индекс, ДлинаНомера - Индекс);   
    
    // ОбластьШапка     
    ПараметрыШапка = Новый Структура;
    ПараметрыШапка.Вставить("НаименованиеОрганизации", Выборка.ОрганизацияПредставление); 
    ПараметрыШапка.Вставить("НомерПриложения", Номер);  
    ПараметрыШапка.Вставить("Дата", ВыборкаДата); 
    ПараметрыШапка.Вставить("НомерПоставщика", "Не ясно, откуда брать");  
    ПараметрыШапка.Вставить("НомерЗаказа", Номер);  
    ПараметрыШапка.Вставить("НаименованиеГрузоотправителя", Выборка.ОрганизацияПредставление);  
    ПараметрыШапка.Вставить("АдресГрузоотправителя", Выборка.АдресОрганизации); 
    ПараметрыШапка.Вставить("НомерТелефона", Выборка.ТелефонОрганизации); 
    ПараметрыШапка.Вставить("НаименованиеГрузополучателя", Выборка.КонтрагентПредставление);  
    ПараметрыШапка.Вставить("АдресГрузополучателя", Выборка.АдресКонтрагента);  

    
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    // ОбластьЗаголовокТаблицы  
    ТабличныйДокумент.Вывести(ОбластьЗаголовокТаблицы);
    
    
    // ОбластьСтрокаТаблицы     
    НомерТовара = 1;
    Количество = Выборка.КоличествоТоваров;
    Пока НомерТовара <= Количество Цикл 
      ПараметрыСтрока = Новый Структура;
      ПараметрыСтрока.Вставить("НомерСтроки", НомерТовара);
      ПараметрыСтрока.Вставить("Артикул", Выборка.НоменклатураАртикул);
      ПараметрыСтрока.Вставить("Наименование", Выборка.НоменклатураНаименование);
      ПараметрыСтрока.Вставить("Страна", "Не ясно, откуда брать");
      ПараметрыСтрока.Вставить("РегистрационныйНомер", "Не ясно, откуда брать");
      ПараметрыСтрока.Вставить("ДатаВыдачи", "Не ясно, откуда брать");
      ПараметрыСтрока.Вставить("ДатаОкончания", "Не ясно, откуда брать");
      ПараметрыСтрока.Вставить("НаименованиеОрганизации", Выборка.ОрганизацияНаименованиеПолное);
      ПараметрыСтрока.Вставить("КодОргана", "Не ясно, откуда брать");
      ПараметрыСтрока.Вставить("НазваниеФирмы", "Не ясно, откуда брать");
      
      
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);
      ТабличныйДокумент.Вывести(ОбластьСтрока);
      
      НомерТовара = НомерТовара + 1;  
      Выборка.Следующий();
    КонецЦикла;
            
    ТабличныйДокумент.Вывести(ОбластьШапкаРасшифровка);
    
    
    ПараметрыСтрокаРасшифровки = Новый Структура;
    ПараметрыСтрокаРасшифровки.Вставить("Код", "");
    ПараметрыСтрокаРасшифровки.Вставить("Расшифровка", "");
        
    ОбластьСтрокаРасшифровки.Параметры.Заполнить(ПараметрыСтрокаРасшифровки);   
    ТабличныйДокумент.Вывести(ОбластьСтрокаРасшифровки);
    
    ПараметрыПодвал = Новый Структура;
    ПараметрыПодвал.Вставить("НомерТелефона", Выборка.ТелефонОрганизации);  
    ПараметрыПодвал.Вставить("Почта", Выборка.АдресЭП); 
    
    ОбластьПодвал.Параметры.Заполнить(ПараметрыПодвал);   

    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуПриложениеКНакладнойБезРасшифровки(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  //ТабличныйДокумент.ПолеСлева = 5;
  //ТабличныйДокумент.ПолеСправа = 5;
  //ТабличныйДокумент.РазмерКолонтитулаСверху = 0;
  //ТабличныйДокумент.РазмерКолонтитулаСнизу = 0;
  ТабличныйДокумент.АвтоМасштаб = Истина;
  ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПРИЛОЖЕНИЕ_К_НАКЛАДНОЙ";
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  //НомерСтраницы = 1;
  
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда
      
      Макет = ПолучитьМакет("ПриложениеКНакладнойБезРасшифровки");
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
            
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка"); 
      ОбластьЗаголовокТаблицы = Макет.ПолучитьОбласть("ЗаголовокТаблицы"); 
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
            
      ПервыйДокумент = Ложь;
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьШапка, Выборка.Ссылка);
  
    ВыборкаДата = Формат (Выборка.Дата, "ДФ=dd.MM.yyyy");
    
    // Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(Выборка.Номер);      

    // ОбластьШапка     
    НомерВВидеСтроки = Выборка.Номер;
    ДлинаНомера = СтрДлина(НомерВВидеСтроки);
    НачалоЧисловойЧасти = ДлинаНомера - 5;
    НомерВВидеЦифр = Сред(НомерВВидеСтроки, НачалоЧисловойЧасти, 6);
    
    Для Индекс = 0 По СтрДлина(НомерВВидеЦифр) Цикл
      Если Сред(НомерВВидеЦифр, Индекс, 1) <> "0" Тогда   
        Прервать;
      КонецЕсли;      
    КонецЦикла;
    
    Номер = Сред(НомерВВидеЦифр, Индекс, ДлинаНомера - Индекс);   
    
    // ОбластьШапка     
    ПараметрыШапка = Новый Структура;
    ПараметрыШапка.Вставить("НаименованиеОрганизации", Выборка.ОрганизацияПредставление); 
    ПараметрыШапка.Вставить("НомерПриложения", Номер);  
    ПараметрыШапка.Вставить("Дата", ВыборкаДата); 
    ПараметрыШапка.Вставить("НомерПоставщика", "Не ясно, откуда брать");  
    ПараметрыШапка.Вставить("НомерЗаказа", Номер);  
    ПараметрыШапка.Вставить("НаименованиеГрузоотправителя", Выборка.ОрганизацияПредставление);  
    ПараметрыШапка.Вставить("АдресГрузоотправителя", Выборка.АдресОрганизации); 
    ПараметрыШапка.Вставить("НомерТелефона", Выборка.ТелефонОрганизации); 
    ПараметрыШапка.Вставить("НаименованиеГрузополучателя", Выборка.КонтрагентПредставление);  
    ПараметрыШапка.Вставить("АдресГрузополучателя", Выборка.АдресКонтрагента);  

    
    
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка);   
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    // ОбластьЗаголовокТаблицы  
    ТабличныйДокумент.Вывести(ОбластьЗаголовокТаблицы);
    
    
    // ОбластьСтрокаТаблицы     
    НомерТовара = 1;
    Количество = Выборка.КоличествоТоваров;
    Пока НомерТовара <= Количество Цикл 
      ПараметрыСтрока = Новый Структура;
      ПараметрыСтрока.Вставить("НомерСтроки", НомерТовара);
      ПараметрыСтрока.Вставить("Артикул", Выборка.НоменклатураАртикул);
      ПараметрыСтрока.Вставить("Наименование", Выборка.НоменклатураНаименование);
      ПараметрыСтрока.Вставить("Страна", "");
      ПараметрыСтрока.Вставить("РегистрационныйНомер", "");
      ПараметрыСтрока.Вставить("ДатаВыдачи", "");
      ПараметрыСтрока.Вставить("ДатаОкончания", "");
      ПараметрыСтрока.Вставить("НаименованиеОрганизации", Выборка.ОрганизацияНаименованиеПолное);
      ПараметрыСтрока.Вставить("КодОргана", "");
      ПараметрыСтрока.Вставить("НазваниеФирмы", "");
      
      
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);
      ТабличныйДокумент.Вывести(ОбластьСтрока);
      
      НомерТовара = НомерТовара + 1;  
      Выборка.Следующий();
    КонецЦикла;
    
    ПараметрыПодвал = Новый Структура;
    ПараметрыПодвал.Вставить("НомерТелефона", Выборка.ТелефонОрганизации);  
    ПараметрыПодвал.Вставить("Почта", Выборка.АдресЭП); 
                              
    
    ОбластьПодвал.Параметры.Заполнить(ПараметрыПодвал);   
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции

Функция СформироватьПечатнуюФормуНакладнаяПоВозвратуТары(МассивОбъектов) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ТабличныйДокумент = Новый ТабличныйДокумент;
  ТабличныйДокумент.АвтоМасштаб = Истина;
  //ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
  
  ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ПРИЛОЖЕНИЕ_К_НАКЛАДНОЙ"; 
  
  
  Запрос = Новый Запрос;
  Запрос.Текст = 
  "ВЫБРАТЬ
  | ЗаказКлиента.Ссылка КАК Ссылка,
  | ЗаказКлиента.Организация.Представление КАК ОрганизацияПредставление,
  | ЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | ЗаказКлиента.Номер КАК Номер,
  | ЗаказКлиента.Дата КАК Дата,
  | ЗаказКлиента.Представление КАК Представление,
  | ЗаказКлиента.Грузополучатель.Представление КАК ГрузополучательПредставление,
  | ЗаказКлиента.Контрагент.Представление КАК КонтрагентПредставление,
  | ЗаказКлиента.Организация.НаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | ЗаказКлиента.Контрагент.НаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | ЗаказКлиента.Организация.КодПоОКПО КАК ОрганизацияКодПоОКПО,
  | ЗаказКлиента.Грузополучатель.КодПоОКПО КАК ГрузополучательКодПоОКПО,
  | ЗаказКлиента.Контрагент.КодПоОКПО КАК КонтрагентКодПоОКПО,
  | ЗаказКлиента.Организация.ИНН КАК ОрганизацияИНН,
  | ЗаказКлиента.Контрагент.ИНН КАК КонтрагентИНН,
  | ЗаказКлиента.Контрагент.КПП КАК КонтрагентКПП,
  | ЗаказКлиента.Организация.КПП КАК ОрганизацияКПП,
  | ЗаказКлиента.Контрагент КАК Контрагент,
  | ЗаказКлиента.Организация КАК Организация,
  | ЗаказКлиента.Подразделение.Наименование КАК ПодразделениеНаименование,
  | ЗаказКлиента.Подразделение.Представление КАК ПодразделениеПредставление,
  | ЗаказКлиента.Организация.ИндивидуальныйПредприниматель.ФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | ЗаказКлиента.Организация.СвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | ЗаказКлиента.Руководитель.ФизическоеЛицо.ФИО КАК РуководительФизическоеЛицоФИО,
  | ЗаказКлиента.Грузоотправитель.Представление КАК ГрузоотправительПредставление,
  | ЗаказКлиента.ГлавныйБухгалтер.ФизическоеЛицо.ФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО
  |ПОМЕСТИТЬ втЗаказКлиента
  |ИЗ
  | Документ.ЗаказКлиента КАК ЗаказКлиента
  |ГДЕ
  | ЗаказКлиента.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ЗаказКлиентаТовары.Номенклатура.Код КАК НоменклатураКод,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Наименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | ЗаказКлиентаТовары.Номенклатура.ЕдиницаИзмерения.Код КАК НоменклатураЕдиницаИзмеренияКод,
  | ЗаказКлиентаТовары.СуммаСНДС КАК СуммаСНДС,
  | ЗаказКлиентаТовары.СуммаНДС КАК СуммаНДС,
  | ЗаказКлиентаТовары.СтавкаНДС.Ставка КАК СтавкаНДССтавка,
  | ЗаказКлиентаТовары.Цена КАК Цена,
  | ЗаказКлиентаТовары.Количество КАК Количество,
  | ЗаказКлиентаТовары.Номенклатура.Артикул КАК НоменклатураАртикул,
  | ЗаказКлиентаТовары.НомерСтроки КАК НомерСтроки,
  | ЗаказКлиентаТовары.Ссылка КАК Ссылка,
  | ЗаказКлиентаТовары.Номенклатура.Наименование КАК НоменклатураНаименование,
  | ЗаказКлиентаТовары.Номенклатура.Ссылка КАК НоменклатураСсылка,
  | ЗаказКлиентаТовары.Номенклатура.Представление КАК НоменклатураПредставление,
  | ЗаказКлиентаТовары.Номенклатура.КодТНВЭД.Код КАК НоменклатураКодТНВЭДКод,
  | ЗаказКлиентаТовары.Номенклатура.КодДляПоиска КАК НоменклатураКодДляПоиска,
  | ЗаказКлиентаТовары.Номенклатура.ВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | ЗаказКлиентаТовары.Номенклатура.ВесЧислитель КАК НоменклатураВесЧислитель
  |ПОМЕСТИТЬ втТовары
  |ИЗ
  | Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
  |ГДЕ
  | ЗаказКлиентаТовары.Ссылка В(&МассивСсылок)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | МАКСИМУМ(втТовары.НомерСтроки) КАК НомерСтроки,
  | втТовары.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ КоличествоТоваров
  |ИЗ
  | втТовары КАК втТовары
  |
  |СГРУППИРОВАТЬ ПО
  | втТовары.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втОрганизацияТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | ОрганизацииКонтактнаяИнформация.Представление КАК Представление,
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1,
  | ОрганизацииКонтактнаяИнформация.АдресЭП КАК АдресЭП
  |ПОМЕСТИТЬ втОрганизацияАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации.КонтактнаяИнформация КАК ОрганизацииКонтактнаяИнформация
  |   ПО втЗаказКлиента.Организация = ОрганизацииКонтактнаяИнформация.Ссылка
  |ГДЕ
  | ОрганизацииКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентТелефон
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Телефон""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | КонтрагентыКонтактнаяИнформация.Представление КАК Представление,
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование КАК ВидНаименование,
  | втЗаказКлиента.Ссылка КАК Ссылка1
  |ПОМЕСТИТЬ втКонтрагентАдрес
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты.КонтактнаяИнформация КАК КонтрагентыКонтактнаяИнформация
  |   ПО втЗаказКлиента.Контрагент = КонтрагентыКонтактнаяИнформация.Ссылка
  |ГДЕ
  | КонтрагентыКонтактнаяИнформация.Вид.Наименование = ""Юридический адрес""
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛистЗаказы.Ссылка КАК Ссылка,
  | уатМаршрутныйЛистЗаказы.лгЗаказКлиента КАК лгЗаказКлиента
  |ПОМЕСТИТЬ втМаршрутныйЛист
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист.Заказы КАК уатМаршрутныйЛистЗаказы
  |   ПО втЗаказКлиента.Ссылка = уатМаршрутныйЛистЗаказы.лгЗаказКлиента.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | уатМаршрутныйЛист.Водитель1.ФизическоеЛицо КАК Водитель1ФизическоеЛицо,
  | уатМаршрутныйЛист.Водитель2.ФизическоеЛицо КАК Водитель2ФизическоеЛицо,
  | уатМаршрутныйЛист.Маршрут.НомерМаршрута КАК МаршрутНомерМаршрута,
  | втМаршрутныйЛист.лгЗаказКлиента КАК лгЗаказКлиента,
  | уатМаршрутныйЛист.Организация.Представление КАК ОрганизацияПредставление,
  | уатМаршрутныйЛист.АдресНазначения.Адрес КАК АдресНазначенияАдрес,
  | уатМаршрутныйЛист.АдресОтправления.Адрес КАК АдресОтправленияАдрес,
  | уатМаршрутныйЛист.ТС.ГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | уатМаршрутныйЛист.ТС.Марка КАК ТСМарка
  |ПОМЕСТИТЬ втНомерМаршрутаИВодитель
  |ИЗ
  | втМаршрутныйЛист КАК втМаршрутныйЛист
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.уатМаршрутныйЛист КАК уатМаршрутныйЛист
  |   ПО втМаршрутныйЛист.Ссылка = уатМаршрутныйЛист.Ссылка
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | РеализацияТоваровУслуг.Ссылка КАК Ссылка
  |ПОМЕСТИТЬ втРеализацияТоваровИУслуг
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
  |   ПО (РеализацияТоваровУслуг.ЗаказКлиента.Ссылка = втЗаказКлиента.Ссылка)
  |;
  |
  |////////////////////////////////////////////////////////////////////////////////
  |ВЫБРАТЬ
  | втЗаказКлиента.Ссылка КАК Ссылка,
  | втЗаказКлиента.ОрганизацияПредставление КАК ОрганизацияПредставление,
  | втЗаказКлиента.АдресДоставки КАК АдресДоставки,
  | втЗаказКлиента.Номер КАК Номер,
  | втЗаказКлиента.Дата КАК Дата,
  | втЗаказКлиента.Представление КАК Представление,
  | втЗаказКлиента.ГрузополучательПредставление КАК ГрузополучательПредставление,
  | втЗаказКлиента.КонтрагентПредставление КАК КонтрагентПредставление,
  | втЗаказКлиента.ОрганизацияНаименованиеПолное КАК ОрганизацияНаименованиеПолное,
  | втЗаказКлиента.КонтрагентНаименованиеПолное КАК КонтрагентНаименованиеПолное,
  | втЗаказКлиента.ОрганизацияКодПоОКПО КАК ОрганизацияКодПоОКПО,
  | втЗаказКлиента.ГрузополучательКодПоОКПО КАК ГрузополучательКодПоОКПО,
  | втЗаказКлиента.КонтрагентКодПоОКПО КАК КонтрагентКодПоОКПО,
  | втЗаказКлиента.ОрганизацияИНН КАК ОрганизацияИНН,
  | втЗаказКлиента.КонтрагентИНН КАК КонтрагентИНН,
  | втЗаказКлиента.КонтрагентКПП КАК КонтрагентКПП,
  | втЗаказКлиента.ОрганизацияКПП КАК ОрганизацияКПП,
  | втТовары.НоменклатураКод КАК НоменклатураКод,
  | втТовары.НоменклатураЕдиницаИзмеренияНаименование КАК НоменклатураЕдиницаИзмеренияНаименование,
  | втТовары.НоменклатураЕдиницаИзмеренияКод КАК НоменклатураЕдиницаИзмеренияКод,
  | втТовары.СуммаСНДС КАК СуммаСНДС,
  | втТовары.СуммаНДС КАК СуммаНДС,
  | втТовары.СтавкаНДССтавка КАК СтавкаНДССтавка,
  | втТовары.Цена КАК Цена,
  | втТовары.Количество КАК Количество,
  | втТовары.НоменклатураАртикул КАК НоменклатураАртикул,
  | втТовары.НомерСтроки КАК НомерСтроки,
  | КоличествоТоваров.НомерСтроки КАК КоличествоТоваров,
  | втТовары.НоменклатураНаименование КАК НоменклатураНаименование,
  | втКонтрагентТелефон.Представление КАК ТелефонКонтрагента,
  | втОрганизацияТелефон.Представление КАК ТелефонОрганизации,
  | втКонтрагентАдрес.Представление КАК АдресКонтрагента,
  | ШтрихкодыНоменклатуры.Штрихкод КАК Штрихкод,
  | втОрганизацияАдрес.Представление КАК АдресОрганизации,
  | втЗаказКлиента.ПодразделениеНаименование КАК ПодразделениеНаименование,
  | втЗаказКлиента.ПодразделениеПредставление КАК ПодразделениеПредставление,
  | втТовары.НоменклатураПредставление КАК НоменклатураПредставление,
  | втТовары.НоменклатураКодТНВЭДКод КАК НоменклатураКодТНВЭДКод,
  | втЗаказКлиента.ОрганизацияИндивидуальныйПредпринимательФИО КАК ОрганизацияИндивидуальныйПредпринимательФИО,
  | втЗаказКлиента.ОрганизацияСвидетельствоСерияНомер КАК ОрганизацияСвидетельствоСерияНомер,
  | втЗаказКлиента.РуководительФизическоеЛицоФИО КАК РуководительФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель1ФизическоеЛицо.ФИО КАК Водитель1ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.Водитель2ФизическоеЛицо.ФИО КАК Водитель2ФизическоеЛицоФИО,
  | втНомерМаршрутаИВодитель.МаршрутНомерМаршрута КАК МаршрутНомерМаршрута,
  | втТовары.НоменклатураКодДляПоиска КАК НоменклатураКодДляПоиска,
  | втЗаказКлиента.ГрузоотправительПредставление КАК ГрузоотправительПредставление,
  | втНомерМаршрутаИВодитель.ОрганизацияПредставление КАК ОрганизацияПредставление1,
  | втТовары.НоменклатураВесЧислитель КАК НоменклатураВесЧислитель,
  | втТовары.НоменклатураВесЗнаменатель КАК НоменклатураВесЗнаменатель,
  | втНомерМаршрутаИВодитель.АдресНазначенияАдрес КАК АдресНазначенияАдрес,
  | втНомерМаршрутаИВодитель.АдресОтправленияАдрес КАК АдресОтправленияАдрес,
  | втНомерМаршрутаИВодитель.ТСГосударственныйНомерПрицепа КАК ТСГосударственныйНомерПрицепа,
  | втНомерМаршрутаИВодитель.ТСМарка КАК ТСМарка,
  | втЗаказКлиента.ГлавныйБухгалтерФизическоеЛицоФИО КАК ГлавныйБухгалтерФизическоеЛицоФИО,
  | втОрганизацияАдрес.АдресЭП КАК АдресЭП
  |ИЗ
  | втЗаказКлиента КАК втЗаказКлиента
  |   ЛЕВОЕ СОЕДИНЕНИЕ втНомерМаршрутаИВодитель КАК втНомерМаршрутаИВодитель
  |   ПО втЗаказКлиента.Ссылка = втНомерМаршрутаИВодитель.лгЗаказКлиента.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ КоличествоТоваров КАК КоличествоТоваров
  |   ПО втЗаказКлиента.Ссылка = КоличествоТоваров.Ссылка
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияТелефон КАК втОрганизацияТелефон
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентТелефон КАК втКонтрагентТелефон
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентТелефон.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втКонтрагентАдрес КАК втКонтрагентАдрес
  |   ПО втЗаказКлиента.Ссылка = втКонтрагентАдрес.Ссылка1
  |   ЛЕВОЕ СОЕДИНЕНИЕ втОрганизацияАдрес КАК втОрганизацияАдрес
  |   ПО втЗаказКлиента.Ссылка = втОрганизацияАдрес.Ссылка1,
  | втТовары КАК втТовары
  |   ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ШтрихкодыНоменклатуры КАК ШтрихкодыНоменклатуры
  |   ПО втТовары.НоменклатураСсылка = ШтрихкодыНоменклатуры.Номенклатура";
  
  ПервыйДокумент = Истина;  
  
  Запрос.УстановитьПараметр("МассивСсылок", МассивОбъектов);    
  Выборка = Запрос.Выполнить().Выбрать(); 
  
  НомерСтраницы = 1;
  
  Пока Выборка.Следующий() Цикл     
    
    Если ПервыйДокумент Тогда     
      
      Макет = ПолучитьМакет("НакладнаяПоВозвратуТары");
      Макет.КодЯзыка = Метаданные.Языки.Русский.КодЯзыка;
      
      ОбластьШапка = Макет.ПолучитьОбласть("Шапка"); 
      ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
      ОбластьИтого = Макет.ПолучитьОбласть("Итого");
      ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
      
      ПервыйДокумент = Ложь;
      
    Иначе       
      ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();              
      
    КонецЕсли;
    
    //  ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, ОбластьГоризонтальнаяЛицеваяСторона, Выборка.Ссылка);
    //  Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(Выборка.Номер);
    
    // ОбластьШапка 
    ВыборкаДата = Формат (Выборка.Дата, "ДФ=dd.MM.yyyy");

    ПараметрыШапка = Новый Структура;
    ПараметрыШапка.Вставить("НаименованиеОрганизации", Выборка.ОрганизацияПредставление); 
    ПараметрыШапка.Вставить("АдресОрганизации", Выборка.АдресОрганизации);
    ПараметрыШапка.Вставить("НомерНакладной", Выборка.Номер);
    ПараметрыШапка.Вставить("Дата", ВыборкаДата);   
    ПараметрыШапка.Вставить("Покупатель", Выборка.КонтрагентНаименованиеПолное);
    
    ОбластьШапка.Параметры.Заполнить(ПараметрыШапка); 
    ТабличныйДокумент.Вывести(ОбластьШапка);
    
    
    // ОбластьСтрока  
    ПараметрыСтрока = Новый Структура;  
    
    
    НомерТовара = 1;
    ИтогоСумма = 0;
    
    Количество = Выборка.КоличествоТоваров;
    
    Пока НомерТовара <= Количество Цикл 
      
      ПараметрыСтрока.Вставить("НомерСтроки", НомерТовара); 
      ПараметрыСтрока.Вставить("НаименованиеТары", Выборка.НоменклатураНаименование); 
      ПараметрыСтрока.Вставить("Получено", Выборка.Количество); 
      //ПараметрыСтрока.Вставить("ВозвращеноПустой", Выборка.НоменклатураКод);  
      //ПараметрыСтрока.Вставить("ВозвращеноСпрод", Выборка.НоменклатураКод); 
      //ПараметрыСтрока.Вставить("ПогашениеДолга", Выборка.НоменклатураКод);  
      //ПараметрыСтрока.Вставить("Всего", Выборка.НоменклатураКод); 
      
      ОбластьСтрока.Параметры.Заполнить(ПараметрыСтрока);   
      ТабличныйДокумент.Вывести(ОбластьСтрока);
      
      
      
      //    ИтогоКоличество = ИтогоКоличество + КоличествоТовара;
      ИтогоСумма = ИтогоСумма + Выборка.Количество;
      
      НомерТовара = НомерТовара + 1;  
      Выборка.Следующий();
    КонецЦикла;
    
    
    // ОбластьИтогоПоСтранице 
    ПараметрыИтого = Новый Структура; 
    ПараметрыИтого.Вставить("ПолученоВсего", ИтогоСумма); 
    
    ОбластьИтого.Параметры.Заполнить(ПараметрыИтого);   
    ТабличныйДокумент.Вывести(ОбластьИтого);
    
    ТабличныйДокумент.Вывести(ОбластьПодвал);
    
  КонецЦикла;
  
  Возврат ТабличныйДокумент;
  
КонецФункции



// Вывести штрихкод в табличный документ
//
// Параметры:
//  ТабличныйДокумент - ТабличныйДокумент - Табличный документ
//  Макет - ТабличныйДокумент
//  ОбластьМакета - ОбластьЯчеекТабличногоДокумента - Область
//  Ссылка - ЛюбаяСсылка - Ссылка на документ из которого будет вычислен штрихкод.
//
Процедура ВывестиШтрихкодВТабличныйДокумент(ТабличныйДокумент, Макет, Знач ОбластьМакета, Ссылка) Экспорт
  
  УстановитьПривилегированныйРежим(Истина);
  
  ВыводитьШтрихкодВОтдельнуюОбласть = Ложь;
  Если Не ЕстьКартинкаШтрихкодаВОбластиМакета(ОбластьМакета) Тогда
    // Картинки штрихкода в этой области макета нет.
    
    Если Макет.Области.Найти("ОбластьШтрихкода") <> Неопределено Тогда
      
      // Проверить картинку штрихкода в области "Штрихкод"
      ОбластьМакетаШтрихкод = Макет.ПолучитьОбласть("ОбластьШтрихкода");
      Если ЕстьКартинкаШтрихкодаВОбластиМакета(ОбластьМакетаШтрихкод) Тогда
        ОбластьМакета = ОбластьМакетаШтрихкод;
        ВыводитьШтрихкодВОтдельнуюОбласть = Истина;
      Иначе
        Возврат;
      КонецЕсли;
    Иначе
      Возврат;
    КонецЕсли;
    
  КонецЕсли;
  
  //Если Не ПолучитьФункциональнуюОпцию("ИспользоватьШтрихкодированиеПечатныхФормОбъектов") Тогда
  //  ОбластьМакета.Рисунки.Удалить(ОбластьМакета.Рисунки.КартинкаШтрихкода);
  //  Возврат;
  //КонецЕсли;
  
  Эталон = ЦенообразованиеВызовСервера.ОбработкаПечатьЭтикетокИЦенников().ПолучитьМакет("Эталон");
  РисунокКвадрат = Эталон.Рисунки.Квадрат100Пикселей; // РисунокТабличногоДокумента
  КоличествоМиллиметровВПикселе = РисунокКвадрат.Высота / 100;
  
  ПараметрыШтрихкода = Новый Структура;
  ПараметрыШтрихкода.Вставить("Ширина",           Окр(ОбластьМакета.Рисунки.КартинкаШтрихкода.Ширина / КоличествоМиллиметровВПикселе));
  ПараметрыШтрихкода.Вставить("Высота",           Окр(ОбластьМакета.Рисунки.КартинкаШтрихкода.Высота / КоличествоМиллиметровВПикселе));
  ПараметрыШтрихкода.Вставить("Штрихкод",         СокрЛП(ЧисловойКодПоСсылке(Ссылка)));
  ПараметрыШтрихкода.Вставить("ТипВходныхДанных", 0); // Штрихкод - это строка
  ПараметрыШтрихкода.Вставить("ТипКода",          4); // Code128
  ПараметрыШтрихкода.Вставить("ОтображатьТекст",  Ложь);
  ПараметрыШтрихкода.Вставить("РазмерШрифта",     6);
  
  ОбластьМакета.Рисунки.КартинкаШтрихкода.Картинка = МенеджерОборудованияВызовСервера.ПолучитьКартинкуШтрихкода(ПараметрыШтрихкода);
  
  ВыводитьШтрихкодВОтдельнуюОбласть = Истина;
  
КонецПроцедуры

// Возвращает числовой код для печати штрихкода
//
//  Параметры:
//    Ссылка - ЛюбаяСсылка - ссылка на объект, по которому нужно получить код
//  Возвращаемое значение:
//    Строка - строка из чисел, соответствующая переданной ссылке.
//
Функция ЧисловойКодПоСсылке(Ссылка) Экспорт
  ШестнадцатиричноеЧисло = СтрЗаменить(Строка(Ссылка.УникальныйИдентификатор()),"-","");
  Возврат ПреобразоватьИзШестнадцатеричнойСистемыСчисленияВДесятичноеЧисло(ШестнадцатиричноеЧисло);
КонецФункции

Функция ПреобразоватьИзШестнадцатеричнойСистемыСчисленияВДесятичноеЧисло(Знач Значение)
  
  Значение = НРег(Значение);
  ДлинаСтроки = СтрДлина(Значение);
  
  Результат = 0;
  Для НомерСимвола = 1 По ДлинаСтроки Цикл
    Результат = Результат * 16 + СтрНайти("0123456789abcdef", Сред(Значение, НомерСимвола, 1)) - 1;
  КонецЦикла;
  
  Возврат Формат(Результат, "ЧГ=0");
  
КонецФункции

Функция ЕстьКартинкаШтрихкодаВОбластиМакета(ОбластьМакета)
  
  СтруктураПоиска = Новый Структура;
  СтруктураПоиска.Вставить("КартинкаШтрихкода", Новый УникальныйИдентификатор);
  СтароеЗначение = СтруктураПоиска.КартинкаШтрихкода;
  
  ЗаполнитьЗначенияСвойств(СтруктураПоиска, ОбластьМакета.Рисунки);
  
  Возврат Не СтруктураПоиска.КартинкаШтрихкода = СтароеЗначение;
  
КонецФункции
