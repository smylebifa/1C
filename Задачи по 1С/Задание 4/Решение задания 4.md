## Решение

```
&НаКлиенте
Процедура ТэстоСБ_Реквизит1НачалоВыбораВместо(Элемент, ДанныеВыбора = Неопределено, СтандартнаяОбработка)
  СтандартнаяОбработка = Ложь;
  СписокДляОтбора = НайтиСкладыДляРекв();
  Первый  = Новый Структура("Владелец",СписокДляОтбора);
  Второй = Новый Структура("Отбор, РежимВыбора", Первый, Истина);
  Форма = ОткрытьФорму("Справочник.ЗначенияСвойствОбъектовИерархия.ФормаВыбора", Второй, Элемент,,,,,РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
КонецПроцедуры

&НаСервере
Функция НайтиСкладыДляРекв()
  Возврат ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоРеквизиту("Имя", "ГруппаКлиентов");
КонецФункции   

// Проверка - является ли элемент родителем (группой)
&НаСервере
Функция ЭтотЭлементГруппа(ТекЭлемент) 
  ПроверкаНаГруппу = Новый Запрос(
  "ВЫБРАТЬ
  |Значения.Родитель
  |ИЗ
  | Справочник.ЗначенияСвойствОбъектовИерархия КАК Значения
  |ГДЕ
  | Значения.Владелец = &Владелец И Значения.Родитель.Ссылка = &Ссылка");
  
  ПроверкаНаГруппу.УстановитьПараметр("Владелец", ТекЭлемент.Владелец);
  ПроверкаНаГруппу.УстановитьПараметр("Ссылка", ТекЭлемент);
  
  ЭлементГруппа = Не ПроверкаНаГруппу.Выполнить().Пустой();
  
  Возврат ЭлементГруппа;
КонецФункции


&НаКлиенте
Процедура ТэстоСБ_Реквизит1ОбработкаВыбораПосле(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
  Если ЭтотЭлементГруппа(ВыбранноеЗначение) Тогда 
    Сообщить("Выбранный элемент является группой. Выберите подчиненный элемент.");  
    СтандартнаяОбработка = Ложь;
    ТэстоСБ_Реквизит1НачалоВыбораВместо(Элемент, , Истина); 
    
  Иначе 
    ИзменитьРольСклада(ВыбранноеЗначение);

  КонецЕсли;           
КонецПроцедуры


&НаСервере                              
Процедура ИзменитьРольСклада(Реквизит)
  Свойство = НайтиСкладыДляРекв();
  СтруктураПоиска = Новый Структура("Свойство", Свойство);
  МассивСтрок = ЭтотОбъект.Свойства_ОписаниеДополнительныхРеквизитов.НайтиСтроки(СтруктураПоиска);
  ОписаниеСвойства = МассивСтрок[0];
  
  Если ЗначениеЗаполнено(Реквизит) Тогда  
    ЭтотОбъект[ОписаниеСвойства.ИмяРеквизитаЗначение] = Реквизит;
  Иначе
    ЭтотОбъект[ОписаниеСвойства.ИмяРеквизитаЗначение] = Справочники.ЗначенияСвойствОбъектовИерархия.ПустаяСсылка();
  КонецЕсли;  
  
  ЭтаФорма.Модифицированность = Истина;
КонецПроцедуры


&НаСервере
Процедура ТэстоСБ_ПриСозданииНаСервереПосле(Отказ, СтандартнаяОбработка)
  Свойство = НайтиСкладыДляРекв();
  СтруктураПоиска = Новый Структура("Свойство", Свойство);  
  
  МассивСтрок = Объект.ДополнительныеРеквизиты.НайтиСтроки(СтруктураПоиска);
  
  Если МассивСтрок.Количество() > 0 Тогда 
    ГруппаКлиентов = МассивСтрок[0].Значение;
  КонецЕсли;
КонецПроцедуры


&НаКлиенте                   
Процедура ТэстоСБ_Реквизит1ОчисткаПосле(Элемент, СтандартнаяОбработка)
  ИзменитьРольСклада(Неопределено);
КонецПроцедуры


// Скрываем ГруппаКлиентов из ДопРеквизитов
&НаСервере
&После("СвойстваВыполнитьОтложеннуюИнициализацию")
Процедура ТэстоСБ_СвойстваВыполнитьОтложеннуюИнициализацию()
  Если ЭтаФорма.Свойства_ЭлементыГруппДополнительныхРеквизитов. Количество() > 0 Тогда
    НаборДопРеквизитовПредставление = ЭтаФорма.Свойства_ЭлементыГруппДополнительныхРеквизитов[0].Представление; 
    
    Свойство = НайтиСкладыДляРекв();
    СтруктураПоиска = Новый Структура("Свойство", Свойство);
    МассивСтрок = ЭтотОбъект.Свойства_ОписаниеДополнительныхРеквизитов.НайтиСтроки(СтруктураПоиска);
    
    Если МассивСтрок.Количество () > 0 Тогда 
      НазваниеГруппаКлиентов = МассивСтрок[0].ИмяРеквизитаЗначение;

      ДопРеквизитыФормы = Элементы.ГруппаДополнительныеРеквизиты.ПодчиненныеЭлементы[НаборДопРеквизитовПредставление];    
      ДопРеквизитыФормы.ПодчиненныеЭлементы[НазваниеГруппаКлиентов].Видимость = Ложь; 
    КонецЕсли;
  КонецЕсли;
КонецПроцедуры
```