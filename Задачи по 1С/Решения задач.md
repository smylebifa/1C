# Решения задач

## Разработайте функцию РазложитьСтрокуВМассивПодСтрок. Функция должна принимать 3 параметра. Результатом функции должен быть массив слов из исходной строки, согласно указанному разделителю.

Например, если в качестве параметра передана следующая исходная строка "красный,желтый,синий,зеленый", и разделитель "," (запятая), то функция должна вернуть массив с 4-мя элементами.


Примеры вызова для проверки:
```
Результат1 = РазложитьСтрокуВМассивПодСтрок("синий,желтый", ",");//2 слова - "синий", "желтый"

Результат2 = РазложитьСтрокуВМассивПодСтрок("синий,желтый,", ",");//3 слова - "синий",
"желтый", ""

Результат3 = РазложитьСтрокуВМассивПодСтрок("синий,желтый,", ",", Ложь);//2 слова - "синий",
"желтый"
```

## Решение
```
Функция РазложитьСтрокуВМассивПодСтрок(ИсходнаяСтрока, Разделитель = ",", ИсключатьПустыеСтрокиИзВыборки = Истина)
    МассивЦветов = Новый Массив;
    ОтдельнаяСтрока = "";
    ДлинаСтроки = СтрДлина(ИсходнаяСтрока);
    
    Для Счетчик = 1 По ДлинаСтроки Цикл
        Если Сред(ИсходнаяСтрока, Счетчик, 1) = "," Тогда
            Если ОтдельнаяСтрока = "" Тогда
                Если ИсключатьПустыеСтрокиИзВыборки    Тогда    
                    МассивЦветов.Добавить(ОтдельнаяСтрока);
                КонецЕсли;
                                
            Иначе
                МассивЦветов.Добавить(ОтдельнаяСтрока);
                ОтдельнаяСтрока = "";
                
            КонецЕсли;
            
        Иначе ОтдельнаяСтрока = ОтдельнаяСтрока + Сред(ИсходнаяСтрока, Счетчик, 1);  
            
        КонецЕсли;
    КонецЦикла;
    
    Если ОтдельнаяСтрока <> "" ИЛИ ИсключатьПустыеСтрокиИзВыборки Тогда
        МассивЦветов.Добавить(ОтдельнаяСтрока);
    КонецЕсли;
    
    Возврат МассивЦветов;
КонецФункции
 
Результат1 = РазложитьСтрокуВМассивПодСтрок("синий,желтый", ",");
Для каждого Элемент Из Результат1 Цикл
    Сообщить(Элемент);
КонецЦикла;
```


## Ограничение на выбор реквизитов из списка (возможность выбора только реквизитов не являющихся группами)

## Решение
```
// Проверка - является ли элемент родителем (группой)
&НаСервере
Функция ЭтотЭлементГруппа(ТекЭлемент) 
  ПроверкаНаГруппу = Новый Запрос(
  "ВЫБРАТЬ
  |Значения.Родитель
  |ИЗ
  | Справочник.ЗначенияСвойствОбъектовИерархия КАК Значения
  |ГДЕ
  | Значения.Владелец = &Владелец И Значения.Родитель.Ссылка = &Ссылка");
       
  ПроверкаНаГруппу.УстановитьПараметр("Владелец", ТекЭлемент.Владелец);
  ПроверкаНаГруппу.УстановитьПараметр("Ссылка", ТекЭлемент);

  ЭлементГруппа = Не ПроверкаНаГруппу.Выполнить().Пустой();
     
  Возврат ЭлементГруппа;
КонецФункции


&НаСервере
Функция ВызываемаяФормаИзДопРеквизитаГруппаКлиентов(ДопРеквизит)
  Если ДопРеквизит = ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоНаименованию("Группа Клиентов") Тогда 
    Возврат Истина;
    
  Иначе Возврат Ложь;
    
  КонецЕсли;
КонецФункции


&НаКлиенте
Процедура ТэстоСБ_СписокВыборПосле(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
  ДопРеквизитВызвавшийФорму = Элемент.Родитель.Свойство;
  
  Если ВызываемаяФормаИзДопРеквизитаГруппаКлиентов(ДопРеквизитВызвавшийФорму) Тогда
    Если ЭтотЭлементГруппа(ВыбраннаяСтрока) Тогда 
      Сообщить("Выбранный элемент является группой. Выберите подчиненный элемент.");  
      СтандартнаяОбработка = Ложь;
      
    Иначе 
      Поле = ВыбраннаяСтрока;
      
    КонецЕсли;
  КонецЕсли;  
КонецПроцедуры
```


## Скрываем на форме "ФормаЭлементаРеквизитыКонтрагента" и аналогично в "ПомощникНового" один доп реквизит

```
&НаКлиенте
Процедура ТэстоСБ_Реквизит1НачалоВыбораВместо(Элемент, ДанныеВыбора = Неопределено, СтандартнаяОбработка)
  СтандартнаяОбработка = Ложь;
  СписокДляОтбора = НайтиСкладыДляРекв();
  Первый  = Новый Структура("Владелец",СписокДляОтбора);
  Второй = Новый Структура("Отбор, РежимВыбора", Первый, Истина);
  Форма = ОткрытьФорму("Справочник.ЗначенияСвойствОбъектовИерархия.ФормаВыбора", Второй, Элемент,,,,,РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
КонецПроцедуры

&НаСервере
Функция НайтиСкладыДляРекв()
  Возврат ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоРеквизиту("Имя", "ГруппаКлиентов");
КонецФункции   

// Проверка - является ли элемент родителем (группой)
&НаСервере
Функция ЭтотЭлементГруппа(ТекЭлемент) 
  ПроверкаНаГруппу = Новый Запрос(
  "ВЫБРАТЬ
  |Значения.Родитель
  |ИЗ
  | Справочник.ЗначенияСвойствОбъектовИерархия КАК Значения
  |ГДЕ
  | Значения.Владелец = &Владелец И Значения.Родитель.Ссылка = &Ссылка");
  
  ПроверкаНаГруппу.УстановитьПараметр("Владелец", ТекЭлемент.Владелец);
  ПроверкаНаГруппу.УстановитьПараметр("Ссылка", ТекЭлемент);
  
  ЭлементГруппа = Не ПроверкаНаГруппу.Выполнить().Пустой();
  
  Возврат ЭлементГруппа;
КонецФункции


&НаКлиенте
Процедура ТэстоСБ_Реквизит1ОбработкаВыбораПосле(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
  Если ЭтотЭлементГруппа(ВыбранноеЗначение) Тогда 
    Сообщить("Выбранный элемент является группой. Выберите подчиненный элемент.");  
    СтандартнаяОбработка = Ложь;
    ТэстоСБ_Реквизит1НачалоВыбораВместо(Элемент, , Истина); 
    
  Иначе 
    ИзменитьРольСклада(ВыбранноеЗначение);

  КонецЕсли;           
КонецПроцедуры


&НаСервере                              
Процедура ИзменитьРольСклада(Реквизит)
  Свойство = НайтиСкладыДляРекв();
  СтруктураПоиска = Новый Структура("Свойство", Свойство);
  МассивСтрок = ЭтотОбъект.Свойства_ОписаниеДополнительныхРеквизитов.НайтиСтроки(СтруктураПоиска);
  ОписаниеСвойства = МассивСтрок[0];
  
  Если ЗначениеЗаполнено(Реквизит) Тогда  
    ЭтотОбъект[ОписаниеСвойства.ИмяРеквизитаЗначение] = Реквизит;
  Иначе
    ЭтотОбъект[ОписаниеСвойства.ИмяРеквизитаЗначение] = Справочники.ЗначенияСвойствОбъектовИерархия.ПустаяСсылка();
  КонецЕсли;  
  
  ЭтаФорма.Модифицированность = Истина;
КонецПроцедуры


&НаСервере
Процедура ТэстоСБ_ПриСозданииНаСервереПосле(Отказ, СтандартнаяОбработка)
  Свойство = НайтиСкладыДляРекв();
  СтруктураПоиска = Новый Структура("Свойство", Свойство);  
  
  МассивСтрок = Объект.ДополнительныеРеквизиты.НайтиСтроки(СтруктураПоиска);
  
  Если МассивСтрок.Количество() > 0 Тогда 
    ГруппаКлиентов = МассивСтрок[0].Значение;
  КонецЕсли;
КонецПроцедуры


&НаКлиенте                   
Процедура ТэстоСБ_Реквизит1ОчисткаПосле(Элемент, СтандартнаяОбработка)
  ИзменитьРольСклада(Неопределено);
КонецПроцедуры


// Скрываем ГруппаКлиентов из ДопРеквизитов
&НаСервере
&После("СвойстваВыполнитьОтложеннуюИнициализацию")
Процедура ТэстоСБ_СвойстваВыполнитьОтложеннуюИнициализацию()
  Если ЭтаФорма.Свойства_ЭлементыГруппДополнительныхРеквизитов. Количество() > 0 Тогда
    НаборДопРеквизитовПредставление = ЭтаФорма.Свойства_ЭлементыГруппДополнительныхРеквизитов[0].Представление; 
    
    Свойство = НайтиСкладыДляРекв();
    СтруктураПоиска = Новый Структура("Свойство", Свойство);
    МассивСтрок = ЭтотОбъект.Свойства_ОписаниеДополнительныхРеквизитов.НайтиСтроки(СтруктураПоиска);
    
    Если МассивСтрок.Количество () > 0 Тогда 
      НазваниеГруппаКлиентов = МассивСтрок[0].ИмяРеквизитаЗначение;

      ДопРеквизитыФормы = Элементы.ГруппаДополнительныеРеквизиты.ПодчиненныеЭлементы[НаборДопРеквизитовПредставление];    
      ДопРеквизитыФормы.ПодчиненныеЭлементы[НазваниеГруппаКлиентов].Видимость = Ложь; 
    КонецЕсли;
  КонецЕсли;
КонецПроцедуры
```


## Изменение ограничения (расширение) количества сотрудников

ОбщийМодуль.РасчетЗарплатыДляНебольшихОрганизаций
```
Функция ПорогЗапрета() Экспорт
    Возврат 60;
КонецФункции
```



## Порядок создания внешней обработки для печатной формы

1. В конфигурации создать новый файл типа "внешняя обработка". 

2. Подключить можно из "Администрирование - Печатные формы, отчеты и обработки - Дополнительные отчеты и обработки" добавление существующей сохраненной ранее внешней обработки. Также нужно указать размещение, то есть в каком справочнике, документе или другом объекте она вызывается. 

3. В самой обработки  можно указать макет который будет отображаться при выполнении обработки. Основной код написан в модуле объекта, где хранятся стандартные функции - "СведенияОВнешнейОбработки", "ПолучитьТаблицуКоманд", "ДобавитьКоманду", "Печать", "СФормироватьПечатнуюФорму". В последней описывается заполнение макета. В первых формируется структура обработки.


Модуль объекта
```
Функция СведенияОВнешнейОбработке() Экспорт
   ПараметрыРегистрации = Новый Структура;
   МассивНазначений = Новый Массив;
   МассивНазначений.Добавить("Документ.СчетНаОплатуКлиенту"); 
   ПараметрыРегистрации.Вставить("Вид", "ПечатнаяФорма");  
   ПараметрыРегистрации.Вставить("Назначение", МассивНазначений);
   ПараметрыРегистрации.Вставить("Наименование", "Приветствие"); 
   ПараметрыРегистрации.Вставить("БезопасныйРежим", ЛОЖЬ);
   ПараметрыРегистрации.Вставить("Версия", "2.2"); 
   ПараметрыРегистрации.Вставить("Информация", "Спектр Бизнеса"); 
   ТаблицаКоманд = ПолучитьТаблицуКоманд();
   ДобавитьКоманду(ТаблицаКоманд, "Приветствие", "Приветствие", "ВызовСерверногоМетода", Истина, "ПечатьMXL");
   ПараметрыРегистрации.Вставить("Команды", ТаблицаКоманд);
   
   Возврат ПараметрыРегистрации;
КонецФункции

Функция ПолучитьТаблицуКоманд()
  Команды = Новый ТаблицаЗначений;
  Команды.Колонки.Добавить("Представление", Новый ОписаниеТипов("Строка"));
  Команды.Колонки.Добавить("Идентификатор", Новый ОписаниеТипов("Строка")); 
  Команды.Колонки.Добавить("Использование", Новый ОписаниеТипов("Строка"));
  Команды.Колонки.Добавить("ПоказыватьОповещение", Новый ОписаниеТипов("Булево"));
  Команды.Колонки.Добавить("Модификатор", Новый ОписаниеТипов("Строка"));
  
  Возврат Команды;
КонецФункции

Процедура ДобавитьКоманду(ТаблицаКоманд, Представление, Идентификатор, Использование, ПоказыватьОповещение = Ложь, Модификатор = "")
  НоваяКоманда = ТаблицаКоманд.Добавить();
  НоваяКоманда.Представление = Представление;
  НоваяКоманда.Идентификатор = Идентификатор;
  НоваяКоманда.Использование = Использование;
  НоваяКоманда.ПоказыватьОповещение = ПоказыватьОповещение;
  НоваяКоманда.Модификатор = Модификатор;
КонецПроцедуры  

Процедура Печать(МассивОбъектов, КоллекцияПечатныхФорм, ОбъектыПечати , ПараметрыВывода) Экспорт
  УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "Приветствие", "Приветствие", СформироватьПечатнуюФорму(МассивОбъектов[0], ОбъектыПечати));
КонецПроцедуры

Функция СформироватьПечатнуюФорму (СсылкаНаОбъект, ОбъектыПечати) Экспорт
  Ссылка = СсылкаНаОбъект;
  ТабличныйДокумент = Новый ТабличныйДокумент;
  Макет = ПолучитьМакет("Макет");
  
  ОбластьПриветствие = макет.ПолучитьОбласть("ОбластьСПриветствием");
  ТабличныйДокумент.Вывести(ОбластьПриветствие);
  Возврат ТабличныйДокумент;
КонецФункции
```


### Отображаем номера из документов из внешней обработки
```
Процедура Печать(МассивОбъектов, КоллекцияПечатныхФорм, ОбъектыПечати , ПараметрыВывода) Экспорт
  УправлениеПечатью.ВывестиТабличныйДокументВКоллекцию(КоллекцияПечатныхФорм, "Приветствие", "Приветствие", СформироватьПечатнуюФорму(МассивОбъектов, ОбъектыПечати));
КонецПроцедуры

Функция СформироватьПечатнуюФорму (СсылкаНаОбъект, ОбъектыПечати) Экспорт
  ТабДок = Новый ТабличныйДокумент;
  
  Макет = ПолучитьМакет("МакетСУказаниемНомераДокумента");
  Запрос = Новый Запрос;
  Запрос.Текст = 
    "ВЫБРАТЬ
    | СчетНаОплатуКлиенту.Номер КАК Номер
    |ИЗ
    | Документ.СчетНаОплатуКлиенту КАК СчетНаОплатуКлиенту
    |ГДЕ
    | СчетНаОплатуКлиенту.Ссылка В (&СсылкаНаДокумент)";
  
  Запрос.УстановитьПараметр("СсылкаНаДокумент", СсылкаНаОбъект);
  РезультатЗапроса = Запрос.Выполнить();
  ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
  
  ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
  ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("НомерДокумента");
  
  ТабДок.Очистить();
  ТабДок.НачатьАвтогруппировкуСтрок();
  
  ВставлятьРазделительСтраниц = Ложь;
  Пока ВыборкаДетальныеЗаписи.Следующий() Цикл    
    Если ВставлятьРазделительСтраниц Тогда
      ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
    КонецЕсли;
    
    ТабДок.Вывести(ОбластьЗаголовок);
    
    ОбластьДетальныхЗаписей.Параметры.Заполнить(ВыборкаДетальныеЗаписи);
    ТабДок.Вывести(ОбластьДетальныхЗаписей, ВыборкаДетальныеЗаписи.Уровень());
    
    ВставлятьРазделительСтраниц = Истина;   
  КонецЦикла;
  
  ТабДок.ЗакончитьАвтогруппировкуСтрок();
    
  Возврат ТабДок;
КонецФункции
```
